"use strict";(self.webpackChunksunbird_obsrv=self.webpackChunksunbird_obsrv||[]).push([[377],{75359:(e,t,r)=>{r.d(t,{A:()=>m});var a=r(65043),i=r(74600),n=r(71806),l=r(84882),s=r(28076),o=r(10039),c=r(73460),d=r(71094),u=r(28912),h=r(70579);const m=function(e){let{columns:t,data:r,renderHeader:m}=e;const[p,b]=(0,a.useState)(r||[]),f=(0,a.useMemo)((()=>u.sB),[]),g=(0,a.useMemo)((()=>({Filter:u.ev})),[]),y=(0,a.useMemo)((()=>({filters:[],hiddenColumns:["tags"]})),[]),{getTableProps:x,getTableBodyProps:v,headerGroups:A,rows:j,prepareRow:q,state:C,preGlobalFilteredRows:S,setGlobalFilter:w,toggleRowExpanded:R}=(0,d.useTable)({columns:t,data:p,defaultColumn:g,initialState:y,filterTypes:f,autoResetExpanded:!1},d.useGlobalFilter,d.useFilters,d.useExpanded);return(0,a.useEffect)((()=>{b(r)}),[r]),(0,h.jsxs)(i.A,{spacing:2,children:[m?m({preGlobalFilteredRows:S,setGlobalFilter:w,toggleRowExpanded:R,state:C}):null,(0,h.jsxs)(n.A,{...x(),children:[(0,h.jsx)(l.A,{sx:{borderTopWidth:2},children:A.map((e=>(0,h.jsx)(s.A,{...e.getHeaderGroupProps(),children:e.headers.map((e=>{const{style:t={}}=e;return(0,h.jsx)(o.A,{style:t,...e.getHeaderProps([{className:e.className}]),children:e.render("Header")})}))})))}),(0,h.jsxs)(c.A,{...v(),children:[A.map((e=>(0,h.jsx)(s.A,{...e.getHeaderGroupProps(),children:e.headers.map((e=>(0,h.jsx)(o.A,{...e.getHeaderProps([{className:e.className}]),children:e.canFilter?e.render("Filter"):null})))}))),j.map((e=>(q(e),(0,h.jsx)(s.A,{...e.getRowProps(),children:e.cells.map((e=>(0,h.jsx)(o.A,{...e.getCellProps([{className:e.column.className}]),children:e.render("Cell")})))}))))]})]})]})}},99794:(e,t,r)=>{r.d(t,{A:()=>g});var a=r(68903),i=r(42518),n=r(74600),l=r(85865),s=r(81e3),o=r(28627),c=r(11582),d=r(65043),u=r(34124),h=r(73012),m=r(73216),p=r(53536),b=r.n(p),f=r(70579);const g=e=>{const{formData:t,setFormData:r,existingState:p,sectionLabel:g}=e,y=b().get(p,"notification")||{},x=b().get(y,"channels[0]"),[v,A]=(0,d.useState)(x?{notificationChannel:x}:{}),[j,q]=(0,d.useState)([]),C=(0,d.useRef)(null),S=(0,m.Zp)(),w=async()=>{let e=(e=>b().map(e,(e=>{const{id:t,name:r,type:a}=e;return{label:`${r} (${a})`,value:t}})))(await(0,u.$Q)({data:{request:{filters:{status:"live"}}}}).then((e=>b().get(e,"result.notifications")||[])).catch((e=>[])));q(e)},R=[{name:"notificationChannel",label:"Notification Channels",type:"autocomplete",required:!0,selectOptions:b().concat([{label:"none",value:null}],j),tooltip:"Select the channel for notification delivery"}];(0,d.useEffect)((()=>{(async()=>{r((e=>{const{notificationChannel:t}=v,r=b().get(e,"notifications")||{};return{...e,notification:{...r,channels:[t]}}}))})()}),[v]),(0,d.useEffect)((()=>{w()}),[]);return(0,f.jsx)(a.Ay,{container:!0,direction:"column",children:b().get(j,"length")>0?(0,f.jsxs)(a.Ay,{container:!0,direction:"row",alignItems:"center",spacing:2,children:[(0,f.jsx)(a.Ay,{item:!0,xs:6,children:(0,f.jsx)(o.A,{initialValues:v,enableReinitialize:!0,subscribe:A,onSubmit:e=>{},fields:R,ref:C})}),(0,f.jsx)(a.Ay,{item:!0,xs:6,children:(0,f.jsx)(i.A,{variant:"contained",onClick:()=>S("/alertChannels"),children:"Add Notification Channel"})})]}):(0,f.jsx)(a.Ay,{item:!0,xs:12,children:(0,f.jsxs)(n.A,{spacing:4,direction:"column",justifyContent:"center",alignItems:"center",children:[(0,f.jsx)(l.A,{variant:"body1",fontWeight:500,children:"There are no live notification channels yet. Please create/publish one to proceed further"}),(0,f.jsx)(s.A,{children:(0,f.jsx)(c.m,{"data-edataid":h.add_notification_channel,onClick:()=>S("/alertChannels"),variant:"contained",size:"large",sx:{width:"auto"},children:(0,f.jsx)(l.A,{variant:"h5",children:"Create Notification Channel"})})})]})})})}},91087:(e,t,r)=>{r.d(t,{A:()=>y});var a=r(53536),i=r.n(a),n=r(68903),l=r(42518),s=r(28627),o=r(65043),c=r(73033),d=r(69137),u=r(66734),h=r(70579);const m=(0,u.A)((0,h.jsx)("path",{d:"M10 8.64 15.27 12 10 15.36zM8 5v14l11-7z"}),"PlayArrowOutlined");var p=r(18439),b=r(98612),f=r(85260),g=r(79074);const y=e=>{const{setFormData:t,existingState:r,sectionLabel:a,isFieldEditable:u}=e,[y,x]=(0,o.useState)((()=>{if(!i().isEmpty(r)){const e=i().get(r,"operator"),t=i().get(r,"threshold");return i().includes(["within_range","outside_range"],e)?{...i().omit(r,["threshold"]),threshold_from:i().get(t,0),threshold_to:i().get(t,1)}:{...i().omit(r,["threshold_from","threshold_to"]),threshold:i().get(t,0)}}return{}})),v=(0,o.useRef)(null),[A,j]=(0,o.useState)(null===r||void 0===r?void 0:r.category),[q,C]=(0,o.useState)(!1),[S,w]=(0,o.useState)(!1),[R,F]=(0,o.useState)(!1),[_,k]=(0,o.useState)({}),z=(e,t,r)=>{const a=i().get(y,t);return a?!r||i().includes(r,a)?e:void 0:null};(0,o.useEffect)((()=>{const{category:e}=y||{};A!==e&&(x({category:e}),w(!1),j(e))}),[null===y||void 0===y?void 0:y.category]);const M=()=>{const e=i().get(y,"category"),t=i().get(y,"subComponent")||null,r=i().get(_,e)||[];if(i().groupBy(r,"subComponent"),t){const e=i().filter(r,(e=>e.subComponent==t));return i().map(e,(e=>{const{alias:t,metric:r}=e;return{label:t,value:r}}))}return i().map(r,(e=>{const{alias:t,metric:r}=e;return{label:t,value:r}}))},L=()=>{const e=i().get(y,"category"),t=i().get(_,e)||[],r=i().groupBy(t,"subComponent");return i().unset(r,"null"),i().map(i().keys(r),(e=>({label:e,value:e})))},E=i().flatten(i().compact([{name:"category",label:"Component",type:"select",required:!0,disabled:!u("category"),selectOptions:i().map(i().keys(_),(e=>({label:i().capitalize(e),value:e}))),tooltip:"Select the rule category"},((e,t)=>{if(!i().get(y,t))return null;const r=L();return 0==i().size(r)?null:e})({name:"subComponent",label:"Subcomponent",type:"select",required:!0,disabled:!u("subComponent"),selectOptions:L(),tooltip:"Select the rule subcategory"},"category"),z({name:"metric",label:"Metric",type:"select",required:!0,disabled:!u("metric"),selectOptions:M(),tooltip:"Please configure the prometheus metric"},"category",null),z({name:"operator",label:"Operator",type:"select",required:!0,selectOptions:d.GW,disabled:!u("operator"),tooltip:"Operator"},"metric",null),z({name:"threshold",label:"Threshold",type:"number",required:!0,disabled:!u("threshold"),tooltip:"Threshold value to evaluate against the metric"},"operator",["gt","lt"]),z([{name:"threshold_from",label:"Threshold - From",type:"number",required:!0,disabled:!u("category"),tooltip:"Select the Threshold - from value"},{name:"threshold_to",label:"Threshold - To",type:"number",required:!0,disabled:!u("category"),tooltip:"Select the Threshold - to value"}],"operator",["within_range","outside_range"])])),T=c.Ik().shape({category:c.Yj().required(f.isRequired),metric:c.Yj().required(f.isRequired),operator:c.Yj().required(f.isRequired),threshold:c.ai().when("operator",{is:e=>!i().includes(["within_range","outside_range"],e),then:c.ai().required(f.isRequired)}),threshold_from:c.ai().when("operator",{is:e=>i().includes(["within_range","outside_range"],e),then:c.ai().required(f.isRequired).min(0)}),threshold_to:c.ai().when("operator",{is:e=>i().includes(["within_range","outside_range"],e),then:c.ai().required(f.isRequired).min(0).test("Greater threshold_to","Value must be greater than Threshold - From.",(e=>e>i().get(y,"threshold_from")))})}),H=async()=>{const e=await(async()=>(0,g.lt)(v,y))();F(e),t((t=>{const r=i().get(t,"error"),{category:n,metric:l,metricAlias:s}=y,o=i().find(M(),(e=>e.value==l));let c=i().get(o,"label");return c||(c=s),{...t,category:n,queryBuilderContext:{...y,metricAlias:c},error:{...r,[a]:e}}}))};(0,o.useEffect)((()=>{(async()=>{try{const e=await(0,d.Rx)();k(e)}catch(e){}finally{C(!1)}})(),C(!0)}),[]),(0,o.useEffect)((()=>{i().size(y)>0&&H()}),[y]);return(0,h.jsxs)(h.Fragment,{children:[q&&(0,h.jsx)(b.A,{}),(0,h.jsxs)(n.Ay,{container:!0,direction:"column",spacing:2,children:[(0,h.jsx)(n.Ay,{item:!0,sm:2,children:(0,h.jsx)(s.A,{initialValues:y,enableReinitialize:!0,subscribe:x,onSubmit:e=>{},fields:E,size:{sm:6,xs:6,lg:6},validationSchema:T,ref:v,debounce:100})}),(()=>{const e=function(){return w(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])};return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(n.Ay,{item:!0,xs:12,children:(0,h.jsx)(l.A,{disabled:!R,startIcon:(0,h.jsx)(m,{}),variant:"contained",onClick:t=>e(),children:"Run Query"})}),S&&(0,h.jsx)(n.Ay,{item:!0,xs:12,children:(0,h.jsx)(p.A,{random:Math.random(),handleClose:e,queryBuilderContext:y})})]})})()]})]})}},51632:(e,t,r)=>{r.d(t,{A:()=>x});var a=r(53536),i=r.n(a),n=r(68903),l=r(28627),s=r(65043),o=r(73033),c=r(15813),d=r(69137),u=r(37538),h=r(85260),m=r(79074),p=r(97508),b=r(70579);const{spacing:f}=c.A,g=(0,u.AP)(),y=e=>e.match(/\d+/),x=e=>{const{formData:t,setFormData:r,existingState:a,sectionLabel:c,isFieldEditable:u}=e,x=(0,p.d4)((e=>{var t;return(null===e||void 0===e||null===(t=e.config)||void 0===t?void 0:t.validationLimit)||{}})),[v,A]=(0,s.useState)((e=>{const{frequency:t,interval:r}=e;return{...e,...t&&r&&{frequency:y(t),interval:y(r)}}})(a)),j=(0,s.useRef)(),q=(0,s.useMemo)((()=>[{name:"name",label:"Name",type:"text",required:!0,disabled:!u("name"),tooltip:"Name of the alert rule"},{name:"description",label:"Description",type:"text",required:!0,disabled:!u("description"),tooltip:"Description for the alert rule"},{name:"severity",label:"Severity",type:"select",required:!0,selectOptions:d.uS,disabled:!u("severity"),tooltip:"Severity Level for the alert rule"},{name:"frequency",label:"Frequency",type:"slider",config:{step:1,max:30,suffix:"Min"},required:!0,disabled:!u("frequency"),tooltip:"How frequently to evaluate this rule ?"},{name:"interval",label:"Interval",type:"slider",config:{step:1,max:30,suffix:"Min"},required:!0,disabled:!u("interval"),tooltip:"How long the rule should persist in the current state to fire the alert ?"}]),[]),C=(0,s.useMemo)((()=>o.Ik().shape({name:o.Yj().required(h.isRequired).test("Unique Rule Name","Rule name already exists",g.checkUniqueRule(i().get(a,"name"))).test("specialChars",h.hasSpecialCharacters,(e=>!(0,m.e3)(e))).trim(h.whiteSpaceConflict).strict(!0).max(i().get(x,["alertRuleNameMaxLen"])),description:o.Yj().required(h.isRequired).max(300).test("specialChars",h.hasSpecialCharacters,(e=>!(0,m.e3)(e))).trim(h.whiteSpaceConflict).strict(!0),severity:o.Yj().required(h.isRequired),frequency:o.ai().required(h.isRequired),interval:o.ai().required(h.isRequired).test("Greater Interval","Interval must be greater than or equal to frequency.",(e=>e>=i().get(v,"frequency")))})),[v]),S=async()=>{const e=await(async()=>(0,m.lt)(j,v))();r((t=>{const r=i().get(t,"error");return{...t,...v,error:{...r,[c]:e}}}))};return(0,s.useEffect)((()=>{i().size(v)>0&&S()}),[v]),(0,b.jsx)(n.Ay,{container:!0,direction:"column",spacing:f,children:(0,b.jsx)(n.Ay,{item:!0,sm:2,children:(0,b.jsx)(l.A,{initialValues:v,enableReinitialize:!0,subscribe:A,onSubmit:e=>{},fields:q,size:{sm:6,xs:6,lg:6},validationSchema:C,ref:j,debounce:1e3})})})}},83547:(e,t,r)=>{r.d(t,{A:()=>C});var a=r(68903),i=r(42518),n=r(28627),l=r(65043),s=r(73033),o=r(53536),c=r.n(o),d=r(79226),u=r(8248),h=r(75359),m=r(67407),p=r(61966),b=r(69392),f=r(74600),g=r(17392),y=r(70579);const x=e=>{const{labels:t,updateLabels:r,updateFormState:a,edit:i}=e,n=e=>{const a=o.findIndex(t,(t=>t.label===e)),i=o.remove(t,((e,t)=>a!==t));r(i)},s=(0,l.useMemo)((()=>[{label:"Edit",color:"primary",size:"large",icon:(0,y.jsx)(m.A,{}),onClick:async e=>{const{payload:t}=e,{label:r,value:l}=t;a({label:r,value:l}),n(r),i(!0)}},{label:"Delete",color:"primary",size:"large",icon:(0,y.jsx)(p.A,{}),onClick:async e=>{const{payload:t}=e,{label:r}=t;n(r)}}]),[t]),c=(0,l.useMemo)((()=>[{Header:"Label",accessor:"label",disableFilters:!0},{Header:"Value",accessor:"value",disableFilters:!0},{Header:"Actions",disableFilters:!0,Cell(e){var t;let{cell:r}=e;const a=(null===r||void 0===r||null===(t=r.row)||void 0===t?void 0:t.original)||{};return(0,y.jsx)(f.A,{direction:"row",justifyContent:"flex-start",alignItems:"center",children:o.map(s,(i=a,e=>{const{label:t,color:r,size:a,icon:n,onClick:l}=e;return(0,y.jsx)(b.A,{title:t,onClick:e=>l({payload:i}),children:(0,y.jsx)(g.A,{color:r,size:a,children:n})},Math.random())}))});var i}}]),[t]);return(0,y.jsx)(d.A,{content:!1,children:(0,y.jsx)(u.A,{children:(0,y.jsx)(h.A,{columns:c,renderHeader:null,data:t})})})};var v=r(79074),A=r(97508),j=r(85260);const q=e=>c().reduce(e,((e,t,r)=>(c().startsWith(r,"notificationChannel")||(e=[...e,{label:r,value:t}]),e)),[]),C=e=>{const{formData:t,setFormData:r,existingState:o,sectionLabel:d}=e,[u,h]=(0,l.useState)({}),[m,p]=(0,l.useState)(!1),b=(0,A.d4)((e=>{var t;return(null===e||void 0===e||null===(t=e.config)||void 0===t?void 0:t.validationLimit)||{}})),f=(0,l.useRef)(),[g,C]=(0,l.useState)(q((null===o||void 0===o?void 0:o.labels)||{})),[S,w]=(0,l.useState)(!0),R=[{name:"label",label:"Key",type:"text",required:!0},{name:"value",label:"Value",type:"text",required:!0}],F=s.Ik().shape({label:s.Yj().required(j.isRequired).max(c().get(b,["alertRuleLabelsMaxLen"])).trim(j.whiteSpaceConflict).strict(!0).test("specialChars",j.hasSpecialCharacters,(e=>!(0,v.e3)(e))).test("duplicateKey","Please enter a unique key",(e=>{return t=e,!c().find(g,(e=>e.label===t));var t})),value:s.Yj().required(j.isRequired).trim(j.whiteSpaceConflict).strict(!0).test("specialChars",j.hasSpecialCharacters,(e=>!(0,v.e3)(e))).max(c().get(b,["alertRuleLabelsMaxLen"]))}),_=e=>{C(e)},k=e=>{h(e)},z=async()=>{const e=await(async()=>(0,v.lt)(f,u))();w(!e)};return(0,l.useEffect)((()=>{c().size(u)>0&&z()}),[u]),(0,y.jsx)(y.Fragment,{children:(0,y.jsxs)(a.Ay,{container:!0,direction:"row",spacing:2,justifyContent:"center",alignItems:"center",children:[(()=>{const e=c().filter(g,(e=>"type"!==(null===e||void 0===e?void 0:e.label)&&"component"!==(null===e||void 0===e?void 0:e.label)));return 0==c().size(e)?null:(0,y.jsx)(a.Ay,{item:!0,xs:12,children:(0,y.jsx)(x,{labels:e,updateLabels:_,updateFormState:k,edit:p})})})(),(0,y.jsx)(a.Ay,{item:!0,xs:12,children:(0,y.jsx)(n.A,{initialValues:u,enableReinitialize:!0,subscribe:h,onSubmit:e=>{},fields:R,size:{sm:6,xs:6,lg:6},validationSchema:F,ref:f})}),(0,y.jsx)(a.Ay,{item:!0,xs:12,children:(0,y.jsx)(i.A,{variant:"contained",color:"success",disabled:S,onClick:()=>{c().findIndex(g,(e=>e.label===u.label));m?(async()=>{const{label:e,value:t}=u;C((e=>{const t=[...e,u];return q(t),t})),r((r=>{const a=c().get(r,"labels")||{};return{...r,labels:{...a,[e]:t}}})),h({label:"",value:""}),p(!1)})():(()=>{const{label:e,value:t}=u;C((e=>[...e,u])),r((r=>{const a=c().get(r,"labels")||{};return{...r,labels:{...a,[e]:t}}})),h({label:"",value:""}),p(!1)})()},children:m?"Update Label":"Add Label"})})]})})}},18439:(e,t,r)=>{r.d(t,{A:()=>m});r(74600);var a=r(68903),i=r(53536),n=r.n(i),l=r(60446),s=r.n(l),o=r(78293),c=r(39205),d=(r(42518),r(53727),r(65043)),u=r(98612),h=r(70579);const m=e=>{const{handleClose:t,queryBuilderContext:r}=e,{metric:i,threshold:l,threshold_from:m,threshold_to:p,operator:b}=r,[f,g]=(0,d.useState)(null),[y,x]=(0,d.useState)(!1),v=()=>{let e,t;switch(b){case"gt":e=+l,t=100*+l;break;case"lt":t=+l,e=0;break;case"within_range":e=+m,t=+p;break;case"outside_range":e=0,t=m;break;default:return}return{y:e,y2:t,fillColor:"#8AFF8A",opacity:.2}},A=()=>{let e,t;if("outside_range"===b)return e=+p,t=100*+p,{y:e,y2:t,fillColor:"#8AFF8A",opacity:.2}},j=async()=>{x(!0);const e=await(()=>{const e=n().includes(["within_range","outside_range"],b)?[m,p]:l;return{type:"line",series:[],options:{chart:{type:"line",toolbar:{show:!1}},annotations:{yaxis:[{y:+l,borderColor:"#FF0000",strokeDashArray:0,label:{borderColor:"#FF0000",style:{color:"white",background:"#FF0000",padding:{left:2,right:2,top:2,bottom:2}},text:`Threshold value at ${e}`}},v(),A()]},xaxis:{type:"datetime",labels:{formatter:function(e,t){return s().unix(t).format("DD MMM HH:mm")}},title:{text:"Time"}},yaxis:{labels:{formatter:function(e){return"number"===typeof e?n().round(e,1):e}}}},query:{id:"apiResponseTimeTimeseries",type:"api",url:o.A.prometheusReadRange,method:"GET",headers:{},body:{},params:{query:i,step:"5m",start:s()().unix(),end:s()().subtract(1,"day").unix()},parse:e=>{const t=n().get(e,"data.result");return n().map(t,(e=>{const t=n().get(e,"metric");return{name:JSON.stringify(t)||"Unknown",data:n().get(e,"values")}}))},error:()=>[]}}})();g(e),x(!1)};(0,d.useEffect)((()=>{j()}),[i,b,l,m,p]);return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(a.Ay,{container:!0,direction:"column",spacing:2,children:(()=>{if(y)return(0,h.jsx)(u.A,{});if(!f)return null;let e=!1;return setTimeout((()=>{e=!0})),(0,h.jsx)(a.Ay,{item:!0,overflow:"hidden",children:(0,h.jsx)(c.A,{refresh:e,height:"300",metadata:f,interval:1440},Math.random())},Math.random())})()})})}},61966:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(89379),i=r(65043);const n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};var l=r(8436),s=function(e,t){return i.createElement(l.A,(0,a.A)((0,a.A)({},e),{},{ref:t,icon:n}))};const o=i.forwardRef(s)},67407:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(89379),i=r(65043);const n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"};var l=r(8436),s=function(e,t){return i.createElement(l.A,(0,a.A)((0,a.A)({},e),{},{ref:t,icon:n}))};const o=i.forwardRef(s)}}]);
//# sourceMappingURL=377.59e4bcd4.chunk.js.map