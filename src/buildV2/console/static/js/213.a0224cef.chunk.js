"use strict";(self.webpackChunksunbird_obsrv=self.webpackChunksunbird_obsrv||[]).push([[213],{69835:(e,t,a)=>{a.d(t,{A:()=>v,W:()=>f});var i=a(26240),n=a(81e3),s=a(10611),r=a(85865),o=a(35721),l=a(30681),d=a(48734),c=a(85976),u=a(81129),m=a(36091),p=a(61966),h=a(73012),g=a(70579);function x(e){let{value:t,theme:a,...i}=e;return(0,g.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",maxWidth:"22rem"},children:[(0,g.jsx)(n.A,{sx:{width:"20rem",mr:1,color:a.palette.primary[400]},children:(0,g.jsx)(s.A,{variant:"determinate",color:"inherit",...i})}),(0,g.jsx)(n.A,{sx:{minWidth:35},children:(0,g.jsx)(r.A,{variant:"h6",color:"text.secondary",children:`${Math.round(t)}%`})})]})}function f(e,t){return"string"===typeof e?{key:t?`${e}-${t}`:e,preview:e}:{key:t?`${e.name}-${t}`:e.name,name:e.name,size:e.size,path:e.path,type:e.type,preview:e.preview,lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate}}function v(e){let{showList:t=!1,files:a,onRemove:n,type:s}=e;const v=(0,i.A)(),y=a.length>0;return(0,g.jsx)(o.A,{disablePadding:!0,sx:{...y&&s!==u.r.standard&&{my:3},...s===u.r.standard&&{width:"calc(100% - 84px)"}},children:a.map(((e,t)=>{const{key:a,name:i,size:s,preview:o,type:u}=f(e,t);return(0,g.jsxs)(l.Ay,{sx:{my:1,px:2,py:.75,borderRadius:.75,border:e=>`solid 1px ${e.palette.divider}`,alignItems:"center"},children:[(0,g.jsx)(m.A,{style:{width:"30px",fontSize:"1.15rem",marginRight:4}}),(0,g.jsx)(d.A,{primary:(0,g.jsx)(r.A,{textOverflow:"ellipsis",overflow:"hidden",variant:"body1",children:"string"===typeof e?e:i}),primaryTypographyProps:{variant:"subtitle2"},secondaryTypographyProps:{variant:"caption"},sx:{mr:2,maxWidth:250,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}}),(0,g.jsx)(x,{value:100,theme:v}),n&&(0,g.jsx)(c.A,{"data-edataid":`${h.file_remove_single}:${a}`,size:"small",color:"error",shape:"rounded",onClick:()=>n(e),sx:{ml:"auto"},edge:"end",children:(0,g.jsx)(p.A,{style:{fontSize:"1rem"}})})]},a)}))})}},31694:(e,t,a)=>{a.d(t,{Ay:()=>m});var i=a(90310),n=a(63336),s=a(81e3),r=a(85865),o=a(69835),l=a(53536),d=a(70579);const c=e=>Math.ceil(e/Math.pow(1024,2)),u={"file-too-large":"File is larger than allowed size of 5mb"};function m(e){let{fileRejections:t}=e;return(0,d.jsx)(n.A,{variant:"outlined",sx:{py:1,px:2,mt:1,borderColor:"error.light",bgcolor:e=>(0,i.X4)(e.palette.error.main,.08)},children:t.map((e=>{let{file:t,errors:a}=e;const{path:i,size:n}=(0,o.W)(t);return(0,d.jsxs)(s.A,{sx:{my:1},children:[(0,d.jsxs)(r.A,{variant:"subtitle2",noWrap:!0,children:[i,n?` - ${c(n)}mb`:""]}),a.map((e=>{const t=l.get(u,e.code)||e.message;return(0,d.jsx)(s.A,{component:"li",sx:{typography:"caption"},children:t},e.code)}))]},i)}))})}},99600:(e,t,a)=>{a.d(t,{A:()=>i});const i={home:{home:"home"},login:"login",metrics:{infra:"metrics:infra",overallInfra:"metrics:infra",api:"metrics:api",ingestion:"metrics:ingestion",processing:"metrics:processing",storage:"metrics:storage"},dataset:{list:"dataset:list",create:"dataset:create",edit:"dataset:edit",pages:{schema:"json-schema",input:"input",field:"fields",processing:"processing",advanced:"advanced",review:"review"}},masterdataset:{create:"masterDataset:create",edit:"masterDataset:edit",pages:{schema:"json-schema",input:"input",field:"fields",review:"review"}},systemSettings:{list:"systemSettings:list"}}},13691:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(65043),n=a(73216),s=a(60028);const r=e=>{let{type:t="",subtype:a="PAGINATE",pageid:r,object:o={}}=e;const l=(0,n.zy)(),{pathname:d}=l,c={type:t,subtype:a,pageid:r||d,uri:d};(0,i.useEffect)((()=>{(0,s.rH)({edata:c,object:o})}),[r])}},49213:(e,t,a)=>{a.d(t,{A:()=>ii});var i=a(65043),n=a(85865),s=a(25078),r=a(12299),o=a(76839),l=a(81e3),d=a(68903),c=a(67784),u=a(42518),m=a(73033),p=a(53536),h=a.n(p),g=a(35251),x=a(97508),f=a(21945),v=a(29609),y=a(8387),S=a(63516);function j(e){return e.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")}var A=a(23837),b=a(34150),w=a(49777),Y=a(69835),D=a(61376),C=a(73012),_=a(31694),k=a(79074),M=a(98612),F=a(91462),T=a(85260),I=a(59507),z=a(73216),H=a(70579);const E="sample_data",q=e=>{var t;let{setShowWizard:a,datasetType:s,generateInteractTelemetry:r}=e;const o=(0,x.wA)(),h=(0,x.d4)((e=>null===e||void 0===e?void 0:e.wizard)),q=(0,x.d4)((e=>{var t;return(null===e||void 0===e||null===(t=e.config)||void 0===t?void 0:t.maxFileSize)||5242880})),R=p.get(h,["pages",E]),{data:O,files:P,config:$}=(null===R||void 0===R?void 0:R.state)||{},[N,B]=(0,i.useState)(O),[L,V]=(0,i.useState)(P),[W,Z]=(0,i.useState)(!1),U=(null===R||void 0===R||null===(t=R.state)||void 0===t?void 0:t.config)||{name:"",dataset_id:""},[K,G]=(0,i.useState)(null),[X,J]=(0,i.useState)({}),[Q,ee]=(0,i.useState)(!0),[te,ae]=(0,i.useState)([]),ie=(0,x.d4)((e=>{var t;return(null===e||void 0===e||null===(t=e.config)||void 0===t?void 0:t.validationLimit)||{}})),ne=(0,i.useRef)(),se=(0,z.Zp)(),re=async e=>{try{(e=>{const t=p.get(e,"pages.datasetConfiguration.state.config.dataset_id"),a=sessionStorage.getItem(`${t}_activePage`||"");p.set(e,`metadata.${t}_activePage`,parseInt(a)),o((0,f.PF)(e))})(await(0,b.sq)(e,I.Zs.Draft,!0))}catch(t){o((0,y.z3)({message:"Dataset does not exists"})),se("/")}finally{Z(!1)}};(0,i.useEffect)((()=>{(async()=>{try{const e=await(0,b.CO)({data:{}}),t=p.get(e,["data","result","data"]);if(p.size(t)){const e=p.map(t,(e=>p.get(e,"dataset_id")));ae(e)}}catch(e){ae([])}})()}),[]);const oe=(0,S.Wx)({initialValues:$||U,validationSchema:(e=>m.Ik().shape({name:m.Yj().required("Dataset Name is required").min(p.get(e,"datasetMinLen")).max(p.get(e,"datasetMaxLen")).trim(T.whiteSpaceConflict).strict(!0).test("specialChars",T.hasSpecialCharacters,(e=>!(0,k.e3)(e))),dataset_id:m.Yj().required("Dataset ID is Required").min(p.get(e,"datasetIdMinLen")).max(p.get(e,"datasetIdMaxLen")).trim(T.whiteSpaceConflict).strict(!0).test("checkDuplID","ID is already taken",(e=>new Promise((t=>{p.includes(te,e)&&t(!1),t(!0)})))).test("specialChars",T.hasSpecialCharacters,(e=>!(0,k.e3)(e)))}))(ie),onSubmit:async e=>{if(Z(!0),(N||L)&&e){Z(!0);try{L&&await(async e=>{try{var t;const a=await(0,b._s)(e);a.data&&null!==(t=a.data)&&void 0!==t&&t.result&&await Promise.all(p.map(p.get(a,"data.result"),((t,a)=>(0,b.Aq)(t.preSignedUrl,e[a]).catch(console.log))))}catch(a){}})(L);const t=await(async(e,t)=>{const a=p.get(t,"name"),i=Array.isArray(e)?e:[e];try{const e=await(0,w.M)({data:i,config:{dataset:a}});return o((0,f.FA)({id:"jsonSchema",...e})),e}catch(n){throw o((0,y.z3)({message:"Failed to Upload Data"})),n}})(N,e);o((0,f.FA)({id:E,state:{files:L,data:N,config:e,datasetType:s}})),await(async(e,t)=>{try{const a={...e,data_schema:t,type:s},i=await(0,b.oT)({data:a}),n=p.get(i,"data.result.id");return await re(n),i}catch(a){throw a}})(e,p.get(t,"schema"));let i={};p.map(N,(e=>{i=p.merge(i,e)})),o((0,f.$j)({id:E,...i})),(0,b.y7)({}),a(!0)}catch(t){o((0,y.z3)({message:"Failed to upload schema"}))}finally{Z(!1)}}else o((0,y.z3)({message:"Please fill the required fields"}));Z(!1)},enableReinitialize:!0}),le=(0,i.useRef)(oe);ne&&(ne.current=le.current);(0,i.useEffect)((()=>{X!==oe.values&&J(oe.values)}),[oe.values]);const de=async()=>{const e=await(async()=>(0,k.lt)(ne,X))();ee(!e)};return(0,i.useEffect)((()=>{p.isEmpty(N)||de()}),[X,N]),(0,H.jsxs)(H.Fragment,{children:[W&&(0,H.jsx)(M.A,{}),(0,H.jsx)(F.A,{open:W}),(0,H.jsx)(d.Ay,{container:!0,spacing:1,children:(0,H.jsx)(d.Ay,{item:!0,xs:12,sm:12,children:(0,H.jsxs)("form",{onSubmit:oe.handleSubmit,children:[(0,H.jsxs)(D.s,{elevation:1,children:[(0,H.jsx)(D.Z,{children:"Basic Details"}),(0,H.jsxs)(d.Ay,{container:!0,spacing:3,justifyContent:"center",alignItems:"baseline",display:"flex",children:[(0,H.jsx)(d.Ay,{item:!0,xs:12,sm:6,lg:6,children:(0,H.jsx)(A.A,{title:"Name of the dataset",arrow:!0,placement:"top-start",children:(0,H.jsx)(c.A,{name:"name",label:"Dataset Name",onBlur:oe.handleBlur,onChange:e=>((e,t,a,i)=>{t(i,e.target.value),t(a,j(e.target.value))})(e,oe.setFieldValue,"dataset_id","name"),required:!0,value:p.get(oe.values,"name")||"",variant:"outlined",fullWidth:!0,error:Boolean(oe.errors.name),helperText:oe.touched.name&&oe.errors.name&&String(oe.errors.name)})})}),(0,H.jsx)(d.Ay,{item:!0,xs:12,sm:6,lg:6,children:(0,H.jsx)(A.A,{title:"ID for the dataset - for querying",arrow:!0,placement:"top-start",children:(0,H.jsx)(c.A,{name:"dataset_id",label:"Dataset ID",onBlur:oe.handleBlur,onChange:e=>oe.handleChange(e),required:!0,value:p.get(oe.values,"dataset_id"),variant:"outlined",fullWidth:!0,error:Boolean(oe.errors.dataset_id),helperText:oe.touched.dataset_id&&oe.errors.dataset_id&&String(oe.errors.dataset_id)})})})]})]}),(0,H.jsxs)(D.s,{elevation:1,children:[(0,H.jsx)(D.Z,{children:"Upload Data/Schema"}),(0,H.jsx)(d.Ay,{container:!0,spacing:3,justifyContent:"center",alignItems:"center",children:(0,H.jsx)(d.Ay,{item:!0,xs:12,children:(0,H.jsx)(v.A,{generateInteractTelemetry:r,data:N,setData:B,files:L,setFiles:V,maxFileSize:q,allowSchema:!0,subscribeErrors:G})})})]}),L&&p.size(L)>0&&(0,H.jsxs)(D.s,{elevation:1,children:[(0,H.jsxs)(l.A,{display:"flex",justifyContent:"space-between",children:[(0,H.jsx)(n.A,{variant:"h5",gutterBottom:!0,children:"Files Uploaded"}),(0,H.jsx)(u.A,{onClick:()=>{r({edata:{id:C.file_remove_multiple}}),V(null),B(null),o((0,f.cL)({omit:["datasetConfiguration"]}))},children:"Remove all"})]}),(0,H.jsx)(Y.A,{files:L,showList:!1,onRemove:async e=>{const t=L&&L.filter((t=>t!==e)),a=await Promise.all(t.map((e=>(0,k.lb)(e)))),i=(n=a,p.filter(p.flattenDeep(n),(e=>!p.isEmpty(e))));var n;0===p.size(i)?(V(t),B(i),p.isEmpty(t)||o((0,y.z3)({message:"Invalid file contents"}))):(V(t),B(i))}})]}),(null===K||void 0===K?void 0:K.length)>0&&(0,H.jsx)(_.Ay,{fileRejections:K}),(0,H.jsx)(l.A,{display:"flex",justifyContent:"flex-end",children:(0,H.jsx)(g.A,{children:(0,H.jsx)(u.A,{onClick:e=>r({edata:{id:C.create_dataset}}),disabled:W||oe.isSubmitting||p.isEmpty(N)||Q,variant:"contained",sx:{my:2,ml:1},type:"submit",children:"Create Schema"})})})]})})})]})};var R=a(8122),O=a(26240),P=a(74600),$=a(43845),N=a(53727),B=a(21337),L=a(91707),V=a(1195);const W=e=>{let{tooltipText:t,handleClick:a=()=>{},tooltipProps:i,buttonProps:s,label:r,icon:o}=e;return(0,H.jsx)(A.A,{title:t,...i,children:(0,H.jsx)(u.A,{onClick:a,startIcon:o,...s,children:(0,H.jsx)(n.A,{variant:"body2",color:"text.primary",children:r})})})};var Z=a(28912),U=a(30279),K=a(63336),G=a(90889),X=a(86605),J=a(40710),Q=a(46237),ee=a(94786),te=a(55120);const ae=e=>{let{suggestion:t,Icon:a,color:i}=e;return(0,H.jsxs)(l.A,{display:"flex",alignItems:"center",my:1,px:1,children:[(0,H.jsx)(a,{style:{fontSize:"1.15rem",color:i}}),(0,H.jsxs)(l.A,{children:[(0,H.jsx)(n.A,{variant:"body2",mx:1.5,children:t.message}),(0,H.jsx)(n.A,{variant:"body2",mx:1.5,my:.5,children:t.advice})]})]})},ie=e=>{let{showSuggestions:t=!1,flattenedData:a,setRequiredFilter:s,requiredFilter:r,generateInteractTelemetry:o}=e;const c=(0,O.A)(),u=(0,i.useMemo)((()=>{let e=0,t=0,i=0;return p.map((0,b.kg)(a),(a=>{p.has(a,"required")&&a.required?e+=1:t+=1,i+=1})),{requiredCount:e,totalCount:i,notRequiredCount:t}}),[a]),m=e=>e.toString().padStart(2,"0"),h=e=>{if(p.has(e,"suggestions")){const t=[];return p.map(e.suggestions,(e=>{"DATA_TYPE"!==e.resolutionType&&"MUST-FIX"!==e.severity||t.push(e)})),t}return[]},g=(0,i.useMemo)((()=>{const e=p.map(a,((e,t)=>{if(p.has(e,"suggestions")){const t=h(e);return p.size(t)>0}return!1}));return p.includes(e,!0)}),[a]);return(0,H.jsx)(l.A,{children:(0,H.jsx)(U.A,{orientation:"vertical",in:t,children:(0,H.jsxs)(K.A,{elevation:4,sx:{mb:2,pt:3},children:[(0,H.jsx)(D.Z,{px:2,children:"Suggestions"}),g&&(0,H.jsxs)(G.A,{square:!1,defaultExpanded:!0,children:[(0,H.jsx)(X.A,{"aria-controls":"data-type-suggestions",id:"data-type-suggestions-header",children:(0,H.jsx)(n.A,{variant:"h5",children:"Data type suggestions"})}),(0,H.jsx)(J.A,{sx:{p:1,maxHeight:270,overflow:"auto"},children:p.map(a,((e,t)=>{let a=!!e.resolved&&e.resolved;const i=h(e);return p.size(i)>0?(0,H.jsx)(P.A,{direction:"column",mb:.5,children:p.map(e.suggestions,(e=>"MUST-FIX"===e.severity&&a?(0,H.jsx)(d.Ay,{item:!0,xs:12,mx:1,my:.5,children:(0,H.jsx)(ae,{color:c.palette.success.main,suggestion:e,Icon:Q.A})},Math.random()):"MUST-FIX"!==e.severity||a?"DATA_TYPE"===e.resolutionType?(0,H.jsx)(d.Ay,{item:!0,xs:12,mx:1,my:.5,children:(0,H.jsx)(ae,{color:c.palette.info.main,suggestion:e,Icon:te.A})},Math.random()):void 0:(0,H.jsx)(d.Ay,{item:!0,xs:12,mx:1,my:.5,children:(0,H.jsx)(ae,{color:c.palette.error.main,suggestion:e,Icon:ee.A})},Math.random())))},t):null}))})]}),(0,H.jsxs)(G.A,{square:!1,children:[(0,H.jsx)(X.A,{"aria-controls":"required-suggestions",id:"required-suggestions-header",children:(0,H.jsx)(n.A,{variant:"h5",children:"Required field suggestions"})}),(0,H.jsx)(J.A,{children:(0,H.jsxs)(P.A,{direction:"column",children:[(0,H.jsxs)(l.A,{display:"flex",alignItems:"center",my:1,px:1.25,children:[(0,H.jsxs)(n.A,{variant:"body2",fontWeight:500,children:[`${m(u.requiredCount)}/${m(u.totalCount)}`," are marked as required"]}),(0,H.jsx)($.A,{id:"chip",onDelete:"true"===r?()=>{s(""),o({edata:{id:C.remove_mark_as_required_filter}})}:void 0,onClick:()=>{s("true"),o({edata:{id:C.add_mark_as_required_filter}})},label:"Review all fields marked as required",sx:{mx:2},variant:"filled",color:"success"})]}),(0,H.jsxs)(l.A,{display:"flex",alignItems:"center",my:1,px:1.25,children:[(0,H.jsxs)(n.A,{variant:"body2",fontWeight:500,children:[`${m(u.notRequiredCount)}/${m(u.totalCount)}`," are marked as optional"]}),(0,H.jsx)($.A,{id:"chip",onDelete:"false"===r?()=>{s(""),o({edata:{id:C.remove_mark_as_optional_filter}})}:void 0,onClick:()=>{s("false"),o({edata:{id:C.add_mark_as_optional_filter}})},label:"Review all fields marked as optional",sx:{mx:2},variant:"filled",color:"success"})]})]})})]})]})})})};var ne=a(74865),se=a(5247),re=a(86178),oe=a.n(re),le=a(81512),de=a.n(le);const ce={text:"string",number:"number"},ue=["MM/DD/YYYY","DD/MM/YYYY","YYYY-MM-DD","YYYY-DD-MM","YYYY/MM/DD","DD-MM-YYYY","MM-DD-YYYY","MM-DD-YYYY HH:mm:ss","YYYY/MM/DD HH:mm:ss","YYYY-MM-DD HH:mm:ss","YYYY-DD-MM HH:mm:ss","DD/MM/YYYY HH:mm:ss","DD-MM-YYYY HH:mm:ss","MM-DD-YYYY HH:mm:ss.SSS","YYYY-MM-DD HH:mm:ss.SSS","YYYY-DD-MM HH:mm:ss.SSS","YYYY/MM/DD HH:mm:ss.SSS","DD/MM/YYYY HH:mm:ss.SSS","DD-MM-YYYY HH:mm:ss.SSS","DD-MM-YYYYTHH:mm:ss.SSSZ","YYYY-MM-DDTHH:mm:ss.SSSZ","YYYY-DD-MMTHH:mm:ss.SSSZ","YYYY/MM/DDTHH:mm:ss.SSSZ","DD/MM/YYYYTHH:mm:ss.SSSZ","YYYY-DD-MMTHH:mm:ss.SSS","YYYY/MM/DDTHH:mm:ss.SSS","DD/MM/YYYYTHH:mm:ss.SSS","MM-DD-YYYYTHH:mm:ss.SSSZ","DD-MM-YYYYTHH:mm:ssZ","YYYY-MM-DDTHH:mm:ssZ","YYYY-DD-MMTHH:mm:ssZ","YYYY/MM/DDTHH:mm:ssZ","DD/MM/YYYYTHH:mm:ssZ","MM-DD-YYYYTHH:mm:ssZ","MM-DD-YYYYTHH:mm:ss","DD-MM-YYYYTHH:mm:ss","YYYY-MM-DDTHH:mm:ss","YYYY-DD-MMTHH:mm:ss","YYYY/MM/DDTHH:mm:ss","DD/MM/YYYYTHH:mm:ss","DD-MM-YYYY HH:mm:ss.SSSZ","YYYY-MM-DD HH:mm:ss.SSSZ","YYYY-DD-MM HH:mm:ss.SSSZ","YYYY/MM/DD HH:mm:ss.SSSZ","DD/MM/YYYY HH:mm:ss.SSSZ","MM-DD-YYYY HH:mm:ss.SSSZ","DD-MM-YYYY HH:mm:ssZ","YYYY-MM-DD HH:mm:ssZ","YYYY-DD-MM HH:mm:ssZ","YYYY/MM/DD HH:mm:ssZ","DD/MM/YYYY HH:mm:ssZ","MM-DD-YYYY HH:mm:ssZ","DD-MM-YYYYTHH:mm:ss.SSSSSSZ","YYYY-MM-DDTHH:mm:ss.SSSSSSZ","YYYY-DD-MMTHH:mm:ss.SSSSSSZ","YYYY/MM/DDTHH:mm:ss.SSSSSSZ","DD/MM/YYYYTHH:mm:ss.SSSSSSZ","MM-DD-YYYYTHH:mm:ss.SSSSSSZ","DD/MM/YYYYTHH:mm:ss.SSSSSS","YYYY-DD-MMTHH:mm:ss.SSSSSS","YYYY/MM/DDTHH:mm:ss.SSSSSS","YYYY-MM-DDTHH:mm:ss.SSSSSS","MM-DD-YYYYTHH:mm:ss.SSSSSS","DD-MM-YYYYTHH:mm:ss.SSSSSS","DD-MM-YYYY HH:mm:ss.SSSSSS","YYYY-MM-DD HH:mm:ss.SSSSSS","YYYY-DD-MM HH:mm:ss.SSSSSS","YYYY/MM/DD HH:mm:ss.SSSSSS","DD/MM/YYYY HH:mm:ss.SSSSSS","MM-DD-YYYY HH:mm:ss.SSSSSS","DD-MM-YYYY HH:mm:ss.SSSSSSZ","YYYY-MM-DDTHH:mm:ss.SSSSSSSSSZ","YYYY-DD-MMTHH:mm:ss.SSSSSSSSSZ","YYYY/MM/DDTHH:mm:ss.SSSSSSSSSZ","DD/MM/YYYYTHH:mm:ss.SSSSSSSSSZ","MM-DD-YYYYTHH:mm:ss.SSSSSSSSSZ","DD/MM/YYYYTHH:mm:ss.SSSSSSSSS","YYYY-DD-MMTHH:mm:ss.SSSSSSSSS","YYYY/MM/DDTHH:mm:ss.SSSSSSSSS","YYYY-MM-DDTHH:mm:ss.SSSSSSSSS","MM-DD-YYYYTHH:mm:ss.SSSSSSSSS","DD-MM-YYYYTHH:mm:ss.SSSSSSSSS","DD-MM-YYYY HH:mm:ss.SSSSSSSSS","YYYY-MM-DD HH:mm:ss.SSSSSSSSS","YYYY-DD-MM HH:mm:ss.SSSSSSSSS","YYYY/MM/DD HH:mm:ss.SSSSSSSSS","DD/MM/YYYY HH:mm:ss.SSSSSSSSS","MM-DD-YYYY HH:mm:ss.SSSSSSSSS","DD-MM-YYYY HH:mm:ss.SSSSSSSSSZ","DD-MM-YYYYTHH:mm:ss.SSSSSSSSSZ"],me=(e,t,a,i,n,s,r,o)=>{const l={...t},d=p.cloneDeep(a),c=null===l||void 0===l?void 0:l.arrival_format;let u=p.get(o,[c,"store_format",e,"jsonSchema"]);const m=p.get(o,[c,"store_format"]);let h;p.get(m,[e])||(h=p.findKey(o,(t=>p.includes(p.keys(p.get(t,["store_format"])),e))),u=p.get(o,[h,"store_format",e,"jsonSchema"]));i(p.map(d,(a=>p.get(a,"column")===p.get(l,"originalColumn")?{...a,...l,column:l.originalColumn,isModified:!0,data_type:e,...s&&(null===t||void 0===t?void 0:t.oneof)&&{resolved:!0},...h&&{arrival_format:h},...u&&{type:u}}:a))),n((a=>p.map(a,(a=>p.get(a,"column")===p.get(l,"originalColumn")?{...a,...l,column:l.originalColumn,isModified:!0,data_type:e,...s&&(null===t||void 0===t?void 0:t.oneof)&&{resolved:!0},...h&&{arrival_format:h},...u&&{type:u}}:a)))),r(null)},pe=(e,t,a,i,n,s)=>{const r={...e},o=p.cloneDeep(t);a(p.map(o,(e=>p.get(e,"column")===p.get(r,"originalColumn")?{...e,...r,column:r.originalColumn,isModified:!0,...n&&{resolved:!1}}:e))),i((e=>p.map(e,(e=>p.get(e,"column")===p.get(r,"originalColumn")?{...e,...r,column:r.originalColumn,isModified:!0,...n&&{resolved:!1}}:e)))),s(null)},he=(e,t,a,i,n,s,r,o)=>{const l=p.get(s,[e,"store_format"]),d=1===p.size(l)?p.keys(l)[0]:ce[e],c=p.get(s,[e,"store_format",d,"jsonSchema"]),u={...t},m=p.cloneDeep(a);i(p.map(m,(a=>p.get(a,"column")===p.get(u,"originalColumn")?{...a,...u,column:u.originalColumn,isModified:!0,arrival_format:e,...r&&(null===t||void 0===t?void 0:t.oneof)&&{resolved:!0},...d&&{data_type:d},...c&&{type:c}}:a))),n((a=>p.map(a,(a=>p.get(a,"column")===p.get(u,"originalColumn")?{...a,...u,column:u.originalColumn,isModified:!0,arrival_format:e,...r&&(null===t||void 0===t?void 0:t.oneof)&&{resolved:!0},...d&&{data_type:d},...c&&{type:c}}:a)))),o(null)},ge=async(e,t,a)=>{let i={};p.map(t,(e=>{i=p.merge(i,e)}));try{const a=de()(e),n=p.isEmpty(t)?i:JSON.parse(t),s=await a.evaluate(n),r=(e=>{switch(typeof e){case"string":if(/^\d+$/gi.test(e)){const t=parseInt(e,10);return{isValidTimestamp:t>=946684800&&oe()(t).isValid(),type:"epoch"}}{const t=oe()(e,ue,!0).isValid();return{isValidTimestamp:t,type:t?"date-time":"string"}}case"number":const t=e>=946684800&&oe()(e).isValid();let a="";return a=t?"epoch":Number.isInteger(e)?"integer":"double",{isValidTimestamp:t,type:a};default:return{isValidTimestamp:!1,type:""}}})(s);switch(!0){case!s:throw Error(T.noMatchTransformation);case null===s||void 0===s?void 0:s.sequence:return{data_type:"array",schema_type:"array"};case null===r||void 0===r?void 0:r.isValidTimestamp:case p.isString(s):return{data_type:r.type,schema_type:typeof s};case p.isFinite(s):return{data_type:Number.isInteger(s)?"long":"double",schema_type:Number.isInteger(s)?"integer":"number"};case 1==s||0==s:return{data_type:"boolean",schema_type:"boolean"};case p.isObject(s):return{data_type:"object",schema_type:"object"};default:return{data_type:"string",schema_type:"string"}}}catch(n){throw Error((null===n||void 0===n?void 0:n.message)||T.invalidTransformation)}};var xe=a(29059),fe=a(7277),ve=a(13691),ye=a(99600),Se=a(94733),je=a(83462),Ae=a(4219),be=a(35316),we=a(29347);const Ye={title:"Re Upload Sample Files ?",content:(0,H.jsx)(H.Fragment,{children:(0,H.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",bgcolor:"secondary.100",padding:"0.5rem"},children:[(0,H.jsx)("p",{children:(0,H.jsx)("strong",{children:"Please be advised that reupload of sample files will result in the following changes:"})}),(0,H.jsx)("ul",{children:(0,H.jsxs)("li",{children:[(0,H.jsx)("strong",{children:"Loss of Previous Changes:"})," Any previously saved changes will be permanently lost. It will be necessary to update the configuration once again."]})})]})})},De="sample_data",Ce=e=>{const{resetColumns:t,setUploadLoading:a}=e,s=(0,x.d4)((e=>{var t;return(null===e||void 0===e||null===(t=e.config)||void 0===t?void 0:t.maxFileSize)||5242880})),r=(0,x.wA)(),o=(0,x.d4)((e=>null===e||void 0===e?void 0:e.wizard)),[d,c]=(0,i.useState)(!1),[m,p]=(0,i.useState)(!1),[g,S]=(0,i.useState)(),[j,A]=(0,i.useState)(),[C,_]=(0,i.useState)(!1),F=()=>{p(!0)},T=async e=>{try{await(0,b.pe)();const i=h().get(o,["pages","datasetConfiguration","state","config"])||{},n=h().get(o,["pages","datasetConfiguration","state"])||{};try{await(async e=>{try{var t;const a=await(0,b._s)(e);a.data&&null!==(t=a.data)&&void 0!==t&&t.result&&await Promise.all(h().map(h().get(a,"data.result"),((t,a)=>(0,b.Aq)(t.preSignedUrl,e[a]).catch(console.log))))}catch(a){}})(j);const a=await(async(e,t)=>{const a=h().get(t,"name"),i=Array.isArray(e)?e:[e];try{const e=await(0,w.M)({data:i,config:{dataset:a}});return r((0,f.FA)({id:"jsonSchema",...e})),e}catch(n){throw r((0,y.z3)({message:"Failed to Upload Data"})),n}})(e,i);r((0,f.FA)({id:"datasetConfiguration",state:{...n,files:j}})),r((0,f.cL)({preserve:["datasetConfiguration","jsonSchema"]}));let s={};h().map(e,(e=>{s=h().merge(s,e)})),r((0,f.$j)({id:De,...s})),r((0,f.$j)({id:De,suggestedPii:[]})),(0,b.y7)({}),t(h().get(a,"schema"),!0)}catch(a){r((0,y.z3)({message:"Failed to upload schema"}))}}catch(a){(null===a||void 0===a?void 0:a.message)&&r((0,y.z3)({message:null===a||void 0===a?void 0:a.message})),"string"===typeof a&&r((0,y.z3)({message:a}))}},I=async e=>{const t=j&&j.filter((t=>t!==e)),a=await Promise.all(t.map((e=>(0,k.lb)(e)))),i=(n=a,h().filter(h().flattenDeep(n),(e=>!h().isEmpty(e))));var n;0===h().size(i)?(A(t),S(i),h().isEmpty(t)||r((0,y.z3)({message:"Invalid file contents"}))):(A(t),S(i))},z=()=>{A(null),S(null)},E=()=>{a(!1),p(!1),S(null),A(null)};return(0,H.jsxs)(H.Fragment,{children:[C&&(0,H.jsx)(M.A,{}),(0,H.jsx)(u.A,{onClick:e=>c(!0),size:"large",sx:{fontSize:"1.25rem"},startIcon:(0,H.jsx)(Se.A,{style:{fontSize:"1.25rem"}}),children:(0,H.jsx)(n.A,{ml:1,variant:"body2",color:"text.primary",children:"Upload"})}),(0,H.jsx)(V.A,{open:d,action:F,handleClose:()=>c(!1),context:Ye}),(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(je.A,{fullWidth:!0,open:m,onClose:()=>E(),children:(0,H.jsxs)(l.A,{children:[(0,H.jsx)(Ae.A,{children:"Upload Data/Schema"}),(0,H.jsxs)(be.A,{children:[(0,H.jsx)(v.A,{data:g,setData:S,files:j,setFiles:A,maxFileSize:s,allowSchema:!0}),j&&h().size(j)>0&&(0,H.jsxs)(D.s,{elevation:0,children:[(0,H.jsxs)(l.A,{display:"flex",justifyContent:"space-between",children:[(0,H.jsx)(n.A,{variant:"h5",gutterBottom:!0,children:"Files Uploaded"}),(0,H.jsx)(u.A,{onClick:z,children:"Remove all"})]}),(0,H.jsx)(Y.A,{files:j,showList:!1,onRemove:I})]})]}),(0,H.jsxs)(we.A,{children:[(0,H.jsx)(u.A,{color:"error",disabled:C,onClick:e=>E(),children:"Cancel"}),(0,H.jsx)(u.A,{variant:"contained",disabled:C,onClick:e=>(async()=>{_(!0);try{await T(g)}catch(e){r((0,y.z3)({message:"Failed to upload data"}))}finally{E(),_(!1)}})(),autoFocus:!0,children:"Submit"})]})]})})})]})};var _e=a(28627),ke=a(75337);var Me=a(67254),Fe=a(69392),Te=a(24914),Ie=a(95382);const ze=e=>{const{bucket_name:t="bucket_name"}=e,[a,s]=(0,i.useState)("Copy"),[r,o]=(0,i.useState)(!1),l=JSON.stringify({Version:"2012-10-17",Statement:[{Sid:"Statement0",Effect:"Allow",Action:["s3:ListBucket","s3:GetObject","s3:GetObjectAttributes","s3:GetObjectTagging","s3:PutObjectTagging","s3:DeleteObjectTagging"],Resource:[`arn:aws:s3:::${t||"bucket_name"}`,`arn:aws:s3:::${t||"bucket_name"}/*`]}]},null,2);(0,i.useEffect)((()=>{s("Copy")}),[t]);return(0,H.jsx)(H.Fragment,{children:(0,H.jsxs)(G.A,{expanded:r,onChange:()=>{o(!r)},sx:{border:"none",borderRadius:"4px"},children:[(0,H.jsx)(X.A,{"aria-controls":"panel1d-content",id:"panel1d-header",sx:{bgcolor:"#E9F7F8",paddingLeft:0},children:(0,H.jsx)(Me.A,{severity:"info",sx:{lineHeight:0,display:"flex",justifyContent:"center"},children:(0,H.jsx)(n.A,{variant:"caption",fontSize:14,children:"It is recommended to create a new IAM user in AWS and assign the following policy that limits it to certain operations."})})}),(0,H.jsx)(J.A,{sx:{margin:"0rem",bgcolor:"secondary.100"},children:(0,H.jsxs)(d.Ay,{container:!0,children:[(0,H.jsx)(d.Ay,{item:!0,xs:10,children:(0,H.jsx)(n.A,{variant:"caption",fontSize:14,children:(0,H.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word"},children:l})})}),(0,H.jsx)(d.Ay,{item:!0,xs:2,marginTop:1.5,textAlign:"center",children:(0,H.jsx)(Fe.A,{title:a,children:(0,H.jsx)(u.A,{color:"secondary",size:"medium",endIcon:"Copy"==a?(0,H.jsx)(Te.A,{}):(0,H.jsx)(Ie.A,{}),onClick:()=>{navigator.clipboard.writeText(l),s("Copied")},variant:"dashed",children:a})})})]})})]})})};m.Yj().required(T.isRequired).min(3).max(63).test("invalidBucket",T.bucketNameInvalid,(e=>(0,k.e3)(e,k.wr))),m.Yj().optional().trim(T.whiteSpaceConflict).strict(!0).test("validateInvertedComma",T.singleDoubleQuotesInvalid,(e=>!k.r$.test(e))),m.Yj().required(T.isRequired),m.Yj().required(T.isRequired),m.Yj().required(T.isRequired),m.Yj().required(T.isRequired),m.Yj().required(T.isRequired).max(20).test("invalidAccessKey",T.accessKeyInvalid,(e=>(0,k.e3)(e,k.KJ))),m.Yj().required(T.isRequired).max(40).test("invalidSecretKey",T.secretKeyInvalid,(e=>(0,k.e3)(e,k.sR))),m.Yj().required(T.isRequired),m.Yj().required(T.isRequired);var He=a(39939),Ee=a(40036);const qe=e=>{const t=(0,x.d4)((e=>null===e||void 0===e?void 0:e.wizard)),{flattenedData:a,setFlattenedData:s}=e,[r,o]=(0,i.useState)(),c=p.get(t,"pages.jsonSchema.dataMappings",{}),g=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>3?arguments[3]:void 0;const i=p.filter(e,{data_type:"object"}),n=[];Object.keys(a).forEach((e=>{a[e].arrival_format.forEach((t=>{const i=Object.keys(a[e].store_format||{});n.push({label:t,value:t,arrivalType:e.toLowerCase(),storeFormatOptions:i.map((e=>({label:e,value:e})))})}))}));const s=(r=a,Object.keys(r).map((e=>({label:e,value:e})))).map((e=>e));var r;const o=n.filter((e=>e.arrivalType===t));return[{title:"EditLiveDatasetInputs",fields:[{title:"Field path",fields:[{name:"field",label:"Field path",type:"select",selectOptions:p.concat([{label:"$",value:"$.(root)"}],p.map(i,(e=>({label:`$.${null===e||void 0===e?void 0:e.column}`,value:`${null===e||void 0===e?void 0:e.column}`})))),required:!0,validationSchema:m.Yj().required(T.isRequired)},{name:"newfield",label:"New field",tooltip:"Enter name of new field",type:"text",required:!0,validationSchema:m.Yj().required(T.isRequired).test("invalidFieldName",T.newFieldInvalid,(e=>(0,k.e3)(e,k.FO))).test("spaceInField",T.containsSpaces,(e=>(0,k.Fq)(e)))}]},{title:"Arrival format and Data type",fields:[{name:"arrivalformat",label:"Arrival format",type:"select",selectOptions:s,required:!0,validationSchema:m.Yj().required(T.isRequired)},{title:"Data Type",name:"datatype",label:"Data type",type:"select",selectOptions:p.isEmpty(o)?n:o[0].storeFormatOptions,required:!0,validationSchema:m.Yj().required(T.isRequired)}]}]}]}(p.filter(a,(e=>!p.get(e,"isDeleted"))),p.get(r,"arrivalformat"),p.get(r,"field"),c),[f,v]=(0,i.useState)(),S=(0,i.useRef)(p.map(p.get(g,"[0].fields",[]),(()=>i.createRef()))),[j,A]=(0,i.useState)(!0),[b,w]=(0,i.useState)(!1);function Y(e){let t;t="$."===e?"":e;const a=p.get(r,"newfield",""),i=t.split(".");if(!e)return`properties.${a}`;let n=i.map((e=>`properties.${e}`)).join(".");return a&&(n+=`.properties.${a}`),n}(0,i.useEffect)((()=>{o((e=>({...e,...f})))}),[f]);const D=e=>{const t=Object.keys(c).find((t=>t===e));if(t){const e=c[t].arrival_format;return e?e[0]:""}},C="$.(root)"===p.get(r,"field")?"":p.get(r,"field"),_=async()=>(async(e,t)=>{let a=!0;if(e.current)for(let i=0;i<e.current.length;i++){const n=e.current[i].current;if(n){for(const a in t)n.setFieldTouched(a);const e=await n.validateForm(t);h().size(e)>0&&(a=!1)}}return a})(S,r);(0,i.useEffect)((()=>{p.size(r)>0&&(async()=>{const e=await _();A(!e)})()}),[r]);const M=(e,t)=>{const{fields:a,title:i}=e,s=((e,t)=>{const a=h().keys(t),i=h().values(t),n=h().filter(e,(e=>h().includes(a,e.name))),s=t.filter((t=>h().some(e,(e=>t.field===e.name&&h().includes(i,t.value)))));if(n.length&&s.length){const t=h().flatMap(s,(e=>e.formField));return h().concat(e,t)}return e})(a,g)||[],r={};p.forEach(s,(e=>{const t=p.get(e,"validationSchema");t&&(r[e.name]=t)}));const o=m.Ik().shape(r);return(0,H.jsx)(d.Ay,{item:!0,xs:12,sx:{marginBottom:"1rem"},children:(0,H.jsxs)(l.A,{sx:{width:"100%",bgcolor:"background.paper"},children:[(0,H.jsx)(l.A,{children:(0,H.jsxs)(n.A,{variant:"body1",fontWeight:500,children:[i," : "]})}),(0,H.jsx)(l.A,{sx:{my:1},children:b?(0,H.jsx)(Ee.A,{type:"table"}):(0,H.jsx)(_e.A,{subscribe:v,initialValues:{},onSubmit:e=>{},fields:s,size:{sm:4,xs:4,lg:6},validationSchema:o,ref:S.current[t]})})]})})};return(0,H.jsxs)(l.A,{children:[p.map(g,(e=>(0,H.jsx)(d.Ay,{container:!0,children:(0,H.jsx)(d.Ay,{item:!0,xs:12,children:p.map(p.get(e,"fields"),M)})}))),(0,H.jsxs)(d.Ay,{sx:{textAlign:"end"},children:[(0,H.jsx)(u.A,{size:"medium",sx:{fontWeight:500,mt:2,textAlign:"end"},onClick:()=>{w(!0),o({}),A(!0),setTimeout((()=>{w(!1)}),200)},children:"Clear"}),(0,H.jsx)(u.A,{variant:"contained",size:"medium",disabled:j,startIcon:(0,H.jsx)(ke.A,{}),sx:{fontWeight:500,mt:2,textAlign:"end"},onClick:()=>{a.some((e=>e.column===p.get(r,"newfield")))?(0,He.dispatch)((0,y.z3)({message:T.columnAlreadyExists})):(w(!0),(()=>{const e={arrival_format:p.get(r,"arrivalformat"),column:C?`${C}.${p.get(r,"newfield")}`:p.get(r,"newfield"),data_type:p.get(r,"datatype"),key:Y(C||""),ref:Y(C||""),required:!1,type:D(p.get(r,"arrivalformat")),isModified:!0,isNewlyAdded:!0,rollupType:"ignore"},t=p.concat(a,[e]);s(t),(0,He.dispatch)((0,y.kX)({message:T.newFieldAdded})),o({}),setTimeout((()=>{A(!0),w(!1)}),200)})())},children:"Add new field"})]})]})};var Re=a(38089);const Oe=["text","number","boolean","object","array"],Pe="columns",$e={title:"Delete Column",content:"Are you sure you want to delete this column ?"},Ne=[{label:"Must-Fix",id:"MUST-FIX",lookup:"severity",color:"error",edata:"schemaFilter:mustFix"},{label:"Resolved",id:!0,lookup:"resolved",color:"success",edata:"schemaFilter:resolved"}];function Be(e){return(0,H.jsxs)(R.A,{...e,children:[(0,H.jsx)("path",{d:"M18 3.00001V3.00001C19.6569 3.00001 21 4.34315 21 6.00001L21 8.14286C21 8.47698 21 8.64405 20.9234 8.76602C20.8834 8.82962 20.8296 8.8834 20.766 8.92336C20.644 9 20.477 9 20.1429 9L15 9M18 3.00001V3.00001C16.3431 3.00001 15 4.34315 15 6.00001L15 9M18 3.00001L7 3.00001C5.11438 3.00001 4.17157 3.00001 3.58579 3.58579C3 4.17158 3 5.11439 3 7.00001L3 21L6 20L9 21L12 20L15 21L15 9",stroke:"#056ECE","stroke-width":"2"}),(0,H.jsx)("path",{d:"M7 7L11 7",stroke:"#056ECE","stroke-width":"2","stroke-linecap":"round"}),(0,H.jsx)("path",{d:"M8 11H7",stroke:"#056ECE","stroke-width":"2","stroke-linecap":"round"}),(0,H.jsx)("path",{d:"M7 15L10 15",stroke:"#056ECE","stroke-width":"2","stroke-linecap":"round"})]})}const Le=(0,x.Ng)((e=>({wizardStoreState:null===e||void 0===e?void 0:e.wizard})),{})((e=>{const{handleNext:t,setErrorIndex:a,handleBack:s,index:r,wizardStoreState:o,edit:c,master:m=!1,generateInteractTelemetry:h}=e,[g,v]=(0,i.useState)({}),S=(0,x.wA)(),j=(0,x.d4)((e=>null===e||void 0===e?void 0:e.wizard)),A=p.get(j,["pages",Pe]),[b,Y]=(0,i.useState)([]),[_,k]=(0,i.useState)(!1),[T,I]=(0,i.useState)(null),[z,E]=(0,i.useState)(!1),[q,R]=(0,i.useState)(""),U=p.get(j,"pages.jsonSchema.schema"),[K,G]=(0,i.useState)(!1),X=(0,O.A)(),J=p.get(ye.A,[m?"masterdataset":"dataset",c?"edit":"create"]),Q=p.get(ye.A,[m?"masterdataset":"dataset","pages","schema"]);(0,ve.A)({type:"view",pageid:`${J}:${Q}`});(0,i.useEffect)((()=>{le(!b||!p.every(b,{isDeleted:!0}))}),[b]);const ee=e=>S((0,f.FA)({id:Pe,index:r,state:{schema:e||b},error:!(0,w.oL)(e||b)})),te=(0,i.useMemo)((()=>[{Header:()=>null,id:"expander",className:"cell-center",tipText:"",editable:!1,Cell:e=>{let{row:t}=e;const a=t.isExpanded?(0,H.jsx)(B.A,{}):(0,H.jsx)(L.A,{});return t.canExpand&&0===t.depth&&(0,H.jsx)(l.A,{sx:{fontSize:"1rem"},...t.getToggleRowExpandedProps(),children:a})},SubCell:()=>null},{Header:"Field",accessor:"column",tipText:"Name of the field.",editable:!1,Filter:Z.ev,filter:"includes",Cell:e=>{let{value:t,cell:a}=e;const[n,s]=(0,i.useState)(!1),[r,o]=(0,i.useState)("");return(0,xe.PO)({cell:a,value:t,persistState:ee,setFlattenedData:Y,theme:X,text:r,setText:o,edit:n,setEdit:s})}},{Header:"Arrival format ",accessor:"arrival_format",tipText:"Arrival format  of the field",editable:!1,Filter:Z.ev,filter:"includes",Cell:e=>{let{value:t,cell:a,row:n}=e;const s=(0,x.d4)((e=>p.get(e,["wizard","pages",Pe,"state","schema"])||{})),r=p.get(j,"pages.jsonSchema.dataMappings"),[o,l]=(0,i.useState)(null);return(0,xe.xY)({cell:a,value:t,pageData:s,updateFormatType:he,persistState:ee,anchorEl:o,setAnchorEl:l,resetSuggestionResolve:pe,setFlattenedData:Y,validFormatTypes:Oe,dataMappings:r,disabled:n.canExpand})}},{Header:"Data type",accessor:"data_type",tipText:"Data type of the field",errorBg:!0,editable:!1,Filter:Z.ev,filter:"includes",Cell:e=>{let{value:t,cell:a,row:n}=e;const s=(0,x.d4)((e=>p.get(e,["wizard","pages",Pe,"state","schema"])||{})),r=p.get(j,"pages.jsonSchema.dataMappings"),o=p.get(n,["original","arrival_format"]),l=p.keys(p.get(r,[o,"store_format"])),[d,c]=i.useState(null);return(0,xe.zz)({cell:a,value:t,pageData:s,anchorEl:d,setAnchorEl:c,updateDataType:me,persistState:ee,setFlattenedData:Y,resetSuggestionResolve:pe,validDatatypes:l,disabled:n.canExpand,dataMappings:r})}},{Header:"Required",accessor:"required",tipText:"Field is required",editable:!1,Filter:Z.bl,filter:"equals",customValue:q,Cell:e=>{let{value:t,cell:a,updateMyData:i,row:n}=e;return n.canExpand?null:(0,xe.m4)({cell:a,value:t,setFlattenedData:Y,persistState:ee})}},{Header:"Actions",tipText:"Perform actions on the field",editable:!1,disableFilters:!0,Cell:e=>{let{value:t,cell:a,row:i,...n}=e;return i.canExpand?null:(0,xe.ot)({cell:a,value:t,setSelection:v,setOpenAlertDialog:k,theme:X,generateInteractTelemetry:h})}}]),[q,b]),[ae,re]=(0,i.useState)(!1),[oe,le]=(0,i.useState)(!0);(0,i.useEffect)((()=>{S((0,f.WK)({id:"activePage",value:0})),U&&de(U,!1)}),[U]);const de=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=(0,w.E4)(e),i=p.get(A,["state","schema"])||[];let n;n=t?a:i&&i.length>0?i:a,Y(n),ee(n),re(!1)},ce=e=>{const t=p.get(o,["pages",Pe,"state","schema"])||[],a=p.filter(t,(e=>!p.has(e,"isDeleted")));if("severity"===e.lookup){let e=0;return p.forEach(t,(function(t){null===t||void 0===t||!t.oneof||null!==t&&void 0!==t&&t.resolved||(e+=1)})),e}return p.size(p.filter(a,[e.lookup,e.id]))},ue=(ge=(0,w.v2)((e=>p.filter(e,(e=>!p.has(e,"isDeleted"))))((Se=b,T?(0,w._I)(Se,T.lookup):Se)),U),p.sortBy(ge,(e=>null===e||void 0===e?void 0:e.suggestions)));var ge,Se;const je=[{id:"addNewField",title:"Add new field",component:(0,H.jsx)(qe,{flattenedData:b,setFlattenedData:Y}),noGrid:!0}];return(0,H.jsxs)(H.Fragment,{children:[K&&(0,H.jsx)(M.A,{}),(0,H.jsx)(F.A,{open:K}),(0,H.jsxs)(D.s,{elevation:1,children:[(0,H.jsx)(D.Z,{fontWeight:400,children:"1- Schema Details"}),(0,H.jsxs)(P.A,{direction:"row",spacing:1,marginBottom:1,alignItems:"center",justifyContent:"space-between",children:[(0,H.jsxs)(l.A,{display:"flex",justifyContent:"space-evenly",alignItems:"center",children:[(0,H.jsx)(n.A,{variant:"body2",color:"secondary",mr:1,children:"Filter Suggestion by:"}),Ne.map((e=>(0,H.jsx)($.A,{"aria-label":"filter-button",clickable:!0,label:`${e.label} (${ce(e)})`,sx:{mx:.5},color:e.color,size:"medium",variant:T&&T.label===e.label?"filled":"outlined",onClick:()=>(e=>{h({edata:{id:e.edata}}),I(e)})(e)},e.label))),T&&(0,H.jsx)(u.A,{size:"medium",onClick:()=>{h({edata:{id:C.clear_filters}}),I(null)},startIcon:(0,H.jsx)(N.A,{}),sx:{fontWeight:500},children:"Clear filters"})]}),(0,H.jsxs)(l.A,{display:"flex",justifyContent:"space-evenly",alignItems:"center",children:[(0,H.jsx)(Ce,{resetColumns:de,setUploadLoading:G}),(0,H.jsx)(W,{tooltipText:"View all suggestions",icon:(0,H.jsx)(Be,{sx:{color:"transparent",fontSize:"1.25rem"}}),handleClick:()=>{h({edata:{id:C.view_suggestions}}),E((e=>!e))},buttonProps:{size:"large",sx:{fontSize:"1.25rem"}},tooltipProps:{arrow:!0}})]})]}),(0,H.jsx)(ie,{flattenedData:b,showSuggestions:z,setRequiredFilter:R,requiredFilter:q,generateInteractTelemetry:h}),(0,H.jsxs)(d.Ay,{container:!0,spacing:2,children:[(0,H.jsx)(d.Ay,{item:!0,xs:12,sm:12,children:(0,H.jsx)(fe.A,{columns:te,data:ue,updateMyData:(e,t,a)=>{re(!0)},skipPageReset:ae,limitHeight:!0,tHeadHeight:52,showSearchBar:!0,styles:{"&.MuiTableCell-root":{border:"1px solid #D9D9D9"}}})}),(0,H.jsx)(V.A,{open:_,action:()=>{g&&((e=>{const t=null===e||void 0===e?void 0:e.originalColumn;t&&Y((e=>{const a=p.map(e,(e=>({...e,...p.get(e,"column")===t&&{isModified:!0,isDeleted:!0,resolved:!0}})));return ee(a),a}))})(g),v({}))},handleClose:()=>{k(!1)},context:$e})]})]}),(0,H.jsx)(l.A,{mt:2,children:(0,H.jsx)(Re.A,{sections:je})}),(0,H.jsx)(se.A,{pageId:"list:columns",master:m,showPrevious:!1,gotoPreviousSection:()=>{h({edata:{id:C.previous}}),ee(),s()},gotoNextSection:()=>{h({edata:{id:C.proceed}}),(0,w.oL)(b)?(ee(),t()):(S((0,y.z3)({message:"Please resolve conflicts to proceed further"})),a(r))},enableDownload:!0,handleDownload:()=>{if(h({edata:{id:C.download_JSON}}),U&&b){const e=p.get((0,w.Mt)({schema:U},{schema:b}),"schema");(0,ne.z)(e,"json-schema",!0)}},nextDisabled:!(0,w.oL)(b)||!oe,edit:c})]})}));var Ve=a(39336),We=a(79226),Ze=a(15813);const{spacing:Ue}=Ze.A,Ke=e=>{const{id:t,expanded:a,alwaysExpanded:s,title:r,description:o,componentType:c="accordion",navigation:u,setExpanded:m,handleChange:h,index:g,master:x,section:f,noMasterNav:v,noGrid:y=!1,generateInteractTelemetry:S,...j}=e,A=(0,O.A)(),b=t===a,w=()=>y?p.has(j,"component")&&i.cloneElement(j.component,{...e}):(0,H.jsx)(d.Ay,{container:!0,rowSpacing:Ue,columnSpacing:Ue,children:(0,H.jsx)(d.Ay,{item:!0,xs:12,children:p.has(j,"component")&&i.cloneElement(j.component,{...e})})});return(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(l.A,{marginBottom:2,sx:{"& .MuiAccordion-root":{borderColor:A.palette.divider,"& .MuiAccordionSummary-root":{bgcolor:"transparent",flexDirection:"row"},"& .MuiAccordionDetails-root":{borderColor:A.palette.divider},"& .Mui-expanded":{color:A.palette.primary.main}}},children:(()=>{switch(c){case"none":return p.has(j,"component")&&(0,H.jsx)(D.s,{elevation:2,children:(0,H.jsxs)(P.A,{spacing:1,children:[(0,H.jsx)(n.A,{mb:.5,width:"100%",flexShrink:0,variant:"h5",children:r}),(0,H.jsx)(Ve.A,{sx:{height:2,backgroundColor:"primary.main"}}),i.cloneElement(j.component,{...e})]})});case"box":return(0,H.jsx)(We.A,{content:!1,title:r,tagLine:o,headerSX:{p:0,px:2,pt:3},children:(0,H.jsx)(d.Ay,{margin:2,children:w()})});default:return(0,H.jsxs)(G.A,{expanded:b,onChange:h(t),square:!1,children:[(0,H.jsx)(X.A,{"aria-controls":"panel1bh-content",id:"panel1bh-header",sx:{px:2,py:3},children:(0,H.jsxs)(P.A,{direction:"column",spacing:Ue,alignItems:"center",children:[(0,H.jsx)(n.A,{sx:{width:"100%",flexShrink:0},variant:"h5",children:r}),(0,H.jsx)(n.A,{variant:"body2",sx:{color:"text.secondary"},children:o})]})}),(0,H.jsx)(J.A,{sx:y?{p:0}:{},children:w()})]})}})()})})};var Ge=a(53193),Xe=a(78492),Je=a(74605),Qe=a(14256),et=a(51962);const{spacing:tt}=Ze.A,at=e=>{const t=(0,x.wA)(),{description:a,id:s}=e,r=(0,x.d4)((e=>p.get(e,["wizard","pages",s]))),[o,l]=(0,i.useState)({configureRetention:!1,retentionPeriod:0,archivalPolicy:"coldStorage"}),u=(0,S.Wx)({initialValues:r&&{...r.values}||o,onSubmit:e=>m(e)}),m=e=>{t((0,f.$j)({id:s,values:e}))};(0,i.useEffect)((()=>{r&&l(r)}),[r]);const h=e=>{u.setFieldValue(e.target.name,e.target.value);const t={...u.values,[e.target.name]:e.target.value};m(t)};return(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(d.Ay,{container:!0,rowSpacing:2,children:(0,H.jsx)(d.Ay,{item:!0,xs:12,children:(0,H.jsxs)("form",{onSubmit:u.handleSubmit,children:[(()=>{const e="configureRetention";return(0,H.jsxs)(P.A,{spacing:1,my:1,children:[(0,H.jsx)(n.A,{variant:"h6",fontWeight:"500","aria-label":"form-label",gutterBottom:!0,children:"Retention Policy"}),(0,H.jsxs)(d.Ay,{container:!0,rowSpacing:tt,justifyContent:"flex-start",alignItems:"center",children:[(0,H.jsx)(d.Ay,{item:!0,xs:3,children:(0,H.jsx)(Je.A,{name:e,control:(0,H.jsx)(et.A,{name:"configureRetention",checked:u.values.configureRetention,className:"size-medium",onChange:u.handleChange}),label:"Configure Retention Period"},`${e}`)}),(0,H.jsx)(d.Ay,{item:!0,xs:3,children:(0,H.jsx)(Fe.A,{title:"Configure Retention Period in Days",children:(0,H.jsx)(c.A,{label:"Duration in Days",onChange:h,type:"number",name:"retentionPeriod",value:u.values.retentionPeriod,variant:"outlined",fullWidth:!0,autoComplete:"off"})})})]})]})})(),(0,H.jsxs)(P.A,{spacing:1,my:2,children:[(0,H.jsx)(n.A,{variant:"h6",fontWeight:"500","aria-label":"form-label",gutterBottom:!0,children:"Archival Policy"}),(0,H.jsx)(Ge.A,{component:"fieldset",sx:{my:1},children:(0,H.jsxs)(Xe.A,{"aria-label":"gender",value:u.values.archivalPolicy,name:"archivalPolicy",row:!0,onChange:h,children:[(0,H.jsx)(Je.A,{value:"purge",control:(0,H.jsx)(Qe.A,{}),label:"Purge Data"}),(0,H.jsx)(Je.A,{value:"coldStorage",control:(0,H.jsx)(Qe.A,{}),label:"Move to Cold Storage"})]})})]})]})})})})};var it=a(61966),nt=a(32143),st=a(81673),rt=a(72221),ot=a(23592),lt=a(8248),dt=a(85976),ct=a(71612),ut=a(17392),mt=a(11582);const pt=[{label:"COUNT",value:"COUNT"},{label:"MIN",value:"MIN"},{label:"MAX",value:"MAX"},{label:"AVG",value:"AVG"},{label:"SUM",value:"AVG"}],ht=e=>{const{data:t,onClose:a,setSelection:s,persistState:r}=e,[o,d]=(0,i.useState)({}),c=(0,x.d4)((e=>null===e||void 0===e?void 0:e.wizard)),u=p.get(c,["pages","columns","state","schema"])||[],[h,g]=(0,i.useState)(null),f=[{name:"field",label:"Field",type:"autocomplete",required:!0,selectOptions:p.map(u,(e=>{const t=p.get(e,"column");return{label:t,value:t}}))},{name:"aggregateFunction",label:"Aggregate Function",type:"select",required:!0,selectOptions:pt},{name:"rollupFields",label:"Rollup Fields",type:"autocomplete",multiple:!0,selectOptions:p.map(u,(e=>{const t=p.get(e,"column");return{label:t,value:t}})),required:!0},{name:"rollupFieldName",label:"Rollup Field Name",type:"text",required:!0}],v=m.Ik().shape({field:m.Yj().required("This field is required"),aggregateFunction:m.Yj().required("This field is required"),rollupFields:m.YO().min(1,"This field requires atleast 1 property").required("This field is required").nullable(),rollupFieldName:m.Yj().required("This field is required")});return(0,H.jsx)(H.Fragment,{children:(0,H.jsxs)(l.A,{sx:{p:1,py:1.5,width:"50vw",height:"auto",maxWidth:"100%"},children:[(0,H.jsxs)(Ae.A,{component:l.A,display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,H.jsx)(n.A,{variant:"h5",children:"Add New Rollup"}),a?(0,H.jsx)(ut.A,{"aria-label":"close","data-edataid":C.sidebar_close,"data-objectid":"closeCircleOutlined:addNewRollup","data-objecttype":"dataset",onClick:a,sx:{color:e=>e.palette.grey[500]},children:(0,H.jsx)(ct.A,{})}):null]}),(0,H.jsx)(be.A,{children:(0,H.jsx)(P.A,{spacing:2,my:1,children:(0,H.jsx)(_e.A,{initialValues:{},subscribe:d,onSubmit:e=>{},fields:f,size:{xs:12},validationSchema:v,subscribeErrors:g})})}),(0,H.jsx)(we.A,{sx:{px:4},children:(0,H.jsx)(mt.m,{"data-edataid":C.add_dataset_field,"data-objectid":o,"data-objecttype":"dataset",variant:"contained",onClick:e=>{p.keys(h).length>0||p.size(o)===f.length&&(s((e=>{const t=[...e,o];return r(t),t})),a())},size:"large",sx:{width:"auto"},children:(0,H.jsx)(n.A,{variant:"h5",children:"Add Field"})})})]})})},{spacing:gt}=Ze.A,xt=e=>{const t=(0,x.wA)(),{description:a,id:s}=e,r=(0,x.d4)((e=>p.get(e,["wizard","pages",s,"values"]))),[o,m]=(0,i.useState)(!1),[h,g]=(0,i.useState)([]),v=e=>{t((0,f.FA)({id:s,values:e}))};(0,i.useEffect)((()=>{r&&g(r)}),[r]);const y=[{Header:"Field",accessor:"field"},{Header:"Aggregate Function",accessor:"aggregateFunction"},{Header:"Rollup Fields",accessor:"rollupFields",Cell:e=>{let{value:t,cell:a}=e;return t?(0,H.jsx)(l.A,{children:t.map((e=>(0,H.jsx)($.A,{sx:{m:.5},label:e.label},e.value)))}):null}},{Header:"Rollup Field Name",accessor:"rollupFieldName"},{Header:"Actions",Cell:e=>{let{value:t,cell:a}=e;return(0,H.jsx)(dt.A,{"data-edataid":C.delete_dataset_rollup,"data-objectid":"deleteOutlined:rollup","data-objecttype":"dataset",variant:"contained",onClick:e=>{return t=p.get(a,"row.original"),void g((e=>{const a=e.filter((e=>p.get(e,"field")!==p.get(t,"field")));return v(a),a}));var t},children:(0,H.jsx)(it.A,{})})}}];return(0,H.jsx)(H.Fragment,{children:(0,H.jsxs)(d.Ay,{container:!0,rowSpacing:2,children:[(()=>{const e=Ze.A.rollupGranularityTypes,t=p.map(e,(e=>(0,H.jsxs)(nt.A,{value:e,children:[p.upperCase(e)," "]})));return(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(d.Ay,{item:!0,xs:12,children:(0,H.jsxs)(P.A,{direction:"row",spacing:2,children:[(0,H.jsx)(Ge.A,{children:(0,H.jsxs)(P.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,H.jsx)(st.A,{children:"Rollup Granularity"}),(0,H.jsx)(rt.A,{value:"day",sx:{minWidth:"200px"},children:t})]})}),(0,H.jsx)(Ge.A,{children:(0,H.jsxs)(P.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,H.jsx)(st.A,{children:"Rollup Granularity"}),(0,H.jsx)(c.A,{id:"outlined-basic",disabled:!0,value:"datasetid_rollup_hourly"})]})})]})})})})(),(0,H.jsxs)(H.Fragment,{children:[(0,H.jsxs)(d.Ay,{item:!0,xs:12,children:[" ",p.get(h,"length")?(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(We.A,{content:!1,headerSX:{},children:(0,H.jsx)(lt.A,{children:(0,H.jsx)(ot.A,{columns:y,data:h,striped:!0})})})}):null]}),(0,H.jsx)(d.Ay,{item:!0,xs:12,children:(0,H.jsx)(P.A,{spacing:gt,direction:"row",justifyContent:"flex-end",children:(0,H.jsx)(u.A,{"data-edataid":C.add_dataset_rollup,"data-objectid":"addRollup","data-objecttype":"dataset",onClick:e=>m(!0),children:(0,H.jsx)(n.A,{variant:"body2",fontWeight:"500",children:"Add New Rollup"})})})}),(0,H.jsx)(d.Ay,{item:!0,xs:12,children:(0,H.jsx)(je.A,{open:o,onClose:e=>m(!1),children:(0,H.jsx)(ht,{setSelection:g,onClose:()=>m(!1),persistState:v})})})]})]})})},ft=[{id:"dataRention",title:"Data Retention And Archival",description:"Data Retention & Archival policy is a set of guidelines that outline how long an organization must keep its data before it can be deleted. Archival policy refers to the process of moving data to a separate storage system or medium for long-term retention and access.",component:(0,H.jsx)(at,{id:"dataRetention"}),componentType:"box",navigation:{next:"rollup"}},{id:"rollup",title:"Rollup Configurations",description:"Rollup configurations are used to define the pre-aggregation of data for faster queries and reduced storage costs. Rollup configurations are defined at the ingestion time and involve specifying how to group data by certain dimensions and aggregate metrics.",component:(0,H.jsx)(xt,{id:"rollup"})}];var vt=a(39948),yt=a(11227),St=a(47830),jt=a(92073);const{spacing:At}=Ze.A,bt={pii:{column:"column",transformation:"_transformationType",transformation_mode:"transformation_mode",id:"id"},transform:{column:"column",transformation:"_transformationType",expression:"transformation",transformation_mode:"transformation_mode",id:"id"},derived:{column:"column",transformation:"transformation",transformation_mode:"transformation_mode",id:"id"}},wt="datasetConfiguration",Yt=e=>{const t=(0,x.wA)(),{id:a,title:s,description:r,actions:o,transformation_mode:c,data:m,label:g,dialog:v,generateInteractTelemetry:S}=e;console.log(e);const[j,A]=(0,i.useState)(!1),[Y,D]=(0,i.useState)([]),_=(0,x.d4)((e=>h().get(e,"wizard.pages"))),k=h().get(_,[a,"selection"]),F=h().get(_,["datasetConfiguration","state","masterId"]),[T,I]=(0,i.useState)(null),[z,E]=(0,i.useState)(!1),[q,R]=(0,i.useState)(!1),O=h().get(_,"timestamp.indexCol"),P=h().flatten([h().get(_,"pii.selection")||[],h().get(_,"transform.selection")||[],h().get(_,"derived.selection")||[],O?[{column:O}]:[]]),N=(0,x.d4)((e=>{var t,a,i,n,s,r,o;return(null===e||void 0===e||null===(t=e.wizard)||void 0===t||null===(a=t.metadata)||void 0===a||null===(i=a.event)||void 0===i||null===(n=i.suggestedPii)||void 0===n?void 0:n.suggestedData)||(null===e||void 0===e||null===(s=e.wizard)||void 0===s||null===(r=s.pages)||void 0===r||null===(o=r.datasetConfiguration)||void 0===o?void 0:o.suggestedPii)||[]})),B=(0,x.d4)((e=>{var t,a,i;return(null===e||void 0===e||null===(t=e.wizard)||void 0===t||null===(a=t.metadata)||void 0===a||null===(i=a.event)||void 0===i?void 0:i.mergedEvent)||h().get(e,"wizard.pages.sample_data")||{}})),L=h().has(B,"$schema")?[]:(0,w.YO)(B),V=async e=>{S({edata:{id:C.delete_dataset_transformation}});const i=()=>t((0,y.z3)({message:"Unable to delete the config item"}));R(!0);try{const n=await(0,b.Et)({dataset_id:F,field_key:h().get(e,"column")});if(h().get(n,"data")){const i=N.filter((t=>t.column!==e.column));t((0,f.$j)({id:wt,suggestedPii:i})),D((i=>{const n=i.filter((t=>h().get(t,"column")!==h().get(e,"column")));var s;return s={selection:n},t((0,f.FA)({id:a,...s})),n}))}else i()}catch(n){i()}finally{R(!1)}},W=e=>{I((t=>{const i=bt[a];let n={};return Object.entries(i).map((t=>{let[a,i]=t;n[a]=h().get(e,[i])})),n})),A(!0),null!==e&&void 0!==e&&e.isSuggestedField?E(!1):E(!0)};(0,i.useEffect)((()=>{k&&D(k),(0,p.isEmpty)(N)&&(async()=>{if("pii"===a)try{var e;let a=await(0,St.h)(L,F);const i=(0,jt.A)(),n=null===a||void 0===a||null===(e=a.data)||void 0===e?void 0:e.result.map((e=>({_transformationType:"mask",_transformedFieldDataType:"string",_transformedFieldSchemaType:"string",id:i,isModified:!0,column:null===e||void 0===e?void 0:e.field,transformation_mode:"Strict",isSuggestedField:!0})));t((0,f.$j)({id:wt,suggestedPii:n}))}catch(i){console.error("Error fetching suggested fields:",i)}})()}),[k]);const Z=e=>{const t=null===e||void 0===e?void 0:e.transformation;return t?(0,H.jsx)(n.A,{variant:"body1",gutterBottom:!0,children:t}):null},U=[{Header:"Field",accessor:"column",Cell:e=>{let{value:t,cell:a}=e;return(0,H.jsx)(l.A,{minWidth:"20vw",maxWidth:"35vw",children:(0,H.jsx)(n.A,{variant:"h5",children:t})})}},{Header:"Data type",accessor:"_transformedFieldDataType",Cell:e=>{let{value:t,cell:a}=e;const i=h().get(a,"row.original.datatype");return(0,H.jsx)(l.A,{minWidth:"10vw",maxWidth:"35vw",children:(0,H.jsx)(n.A,{variant:"body2",children:i||t})})}},{Header:"Mode",accessor:"transformation_mode",Cell:e=>{let{value:t,cell:a}=e;return(0,H.jsx)(l.A,{minWidth:"10vw",maxWidth:"35vw",children:(0,H.jsx)(n.A,{variant:"body2",children:t})})}},{Header:"Transformation",id:"transformation",className:"cell-center",accessor:"transformation",Cell:e=>{var t;let{value:a,cell:i}=e;const s=(null===i||void 0===i||null===(t=i.row)||void 0===t?void 0:t.original)||{},r=null===s||void 0===s?void 0:s._transformationType;return h().get(o,"length")<2&&"custom"===r?(0,H.jsx)(n.A,{variant:"body2",onClick:()=>W(h().get(i,"row.original")),children:Z(s)}):(0,H.jsx)(vt.A,{variant:"outlined","aria-label":"outlined button group",sx:{minWidth:"20vw",maxWidth:"30vw",justifyContent:"center"},children:o.map((e=>(0,H.jsx)(u.A,{size:"large",sx:{py:1,px:2},variant:r===(null===e||void 0===e?void 0:e.value)?"contained":"outlined",onClick:()=>W(h().get(i,"row.original")),children:null===e||void 0===e?void 0:e.label},"one")))})}},{Header:()=>null,id:"actions",Cell:e=>{let{value:t,cell:a}=e;return(0,H.jsx)(dt.A,{onClick:e=>V(h().get(a,"row.original")),children:(0,H.jsx)(it.A,{style:{fontSize:"1.25rem"}})})}}],K=()=>{S({edata:{id:C.dialog_close}}),I(null),A(!1),E(!1)};return(0,H.jsxs)(H.Fragment,{children:[q&&(0,H.jsx)(M.A,{}),h().get(Y,"length")?(0,H.jsx)(d.Ay,{item:!0,xs:12,children:(0,H.jsx)(We.A,{content:!1,headerSX:{},children:(0,H.jsx)(lt.A,{children:(0,H.jsx)(ot.A,{header:!0,columns:U,data:Y,striped:!0})})})}):null,(0,H.jsxs)(d.Ay,{container:!0,rowSpacing:At,columnSpacing:At,children:[(0,H.jsx)(d.Ay,{item:!0,xs:12,textAlign:"end",my:2,children:"pii"===a?(()=>{const e=(()=>{const e=h().uniqBy(N,"column");return k?e.filter((e=>!k.some((t=>t.column===e.column)))):e})();return h().isEmpty(e)?(0,H.jsx)(u.A,{onClick:e=>{A(!0),S({edata:{id:`${C.add_dataset_transformation}:${a}:dialog:open`}})},startIcon:(0,H.jsx)(yt.A,{fontSize:"large"}),children:(0,H.jsx)(n.A,{variant:"body2",fontWeight:"500",children:g})}):(0,H.jsxs)(d.Ay,{sx:{paddingInline:1},children:[(0,H.jsx)(d.Ay,{width:"100%",children:(0,H.jsxs)(We.A,{content:!1,children:[(0,H.jsx)(l.A,{sx:{p:1,textAlign:"start"},children:(0,H.jsx)(n.A,{variant:"body2",fontWeight:"500",children:"Add suggested fields :"})}),(0,H.jsx)(l.A,{sx:{textAlign:"start",overflowY:"scroll",height:"80px"},children:e.map((e=>(0,H.jsx)($.A,{onDelete:()=>{const a=N.filter((t=>t.column!==e.column));t((0,f.$j)({id:wt,suggestedPii:a}))},label:e.column,onClick:()=>(e=>{I((t=>{const i=bt[a];let n={};return Object.entries(i).map((t=>{let[a,i]=t;n[a]=h().get(e,[i])})),n})),A(!0),E(!1)})(e),sx:{ml:1,mb:1},variant:"outlined"},e.column)))})]})}),(0,H.jsx)(d.Ay,{pt:1,children:(0,H.jsx)(u.A,{onClick:e=>{A(!0),S({edata:{id:`${C.add_dataset_transformation}:${a}:dialog:open`}})},startIcon:(0,H.jsx)(yt.A,{fontSize:"large"}),children:(0,H.jsx)(n.A,{variant:"body2",fontWeight:"500",children:g})})})]})})():(0,H.jsx)(u.A,{onClick:e=>{A(!0),S({edata:{id:`${C.add_dataset_transformation}:${a}:dialog:open`}})},startIcon:(0,H.jsx)(yt.A,{fontSize:"large"}),children:(0,H.jsx)(n.A,{variant:"body2",fontWeight:"500",children:g})})}),(0,H.jsx)(d.Ay,{item:!0,xs:12,children:(0,H.jsx)(je.A,{open:j,onClose:e=>A(!1),"aria-labelledby":s,"aria-describedby":s,children:(()=>{const e=(0,b.kg)(m);return i.cloneElement(v,{id:a,actions:o,transformation_mode:c,selection:Y,setSelection:D,data:e,onClose:K,mainDatasetId:F,generateInteractTelemetry:S,selectedValues:T,edit:z,existingTransformationSelections:P,filterAddedSuggestions:N})})()})})]})]})},{spacing:Dt}=Ze.A,Ct=e=>{const{id:t="timestamp"}=e,a=(0,x.wA)(),n=(0,x.d4)((e=>null===e||void 0===e?void 0:e.wizard)),s=p.get(n,["pages",t]),r=p.get(n,"pages.jsonSchema"),o=p.get(n,"pages.columns.state.schema")||[],l=Object.entries(p.get(r,"configurations.indexConfiguration.index")).map((e=>{let[t,a]=e;return{label:t,value:a}}))||{},[c,u]=(0,i.useState)({}),[h,g]=(0,i.useState)({error:!0}),[v,y]=(0,i.useState)(null),S=p.get(n,["pages","pii","selection"])||[],j=p.get(n,["pages","additionalFields","selection"])||[],A=p.get(n,["pages","transformation","selection"])||[],b=p.flatten([...S,...A,...j]);(0,i.useEffect)((()=>{a((0,f.FA)({id:t,...s||{},error:!p.get(s,"indexCol")}))}),[]),(0,i.useEffect)((()=>{const e=p.get(c,"indexCol");var i,n;e&&(i={indexCol:e},n=!1,a((0,f.FA)({id:t,...i,error:n})))}),[p.get(c,"indexCol")]);const w=e=>t=>!(p.get(t,"isDeleted")||!p.includes(["date-time","date","epoch"],p.get(t,e))),Y=e=>!p.find(b,["column",p.get(e,"column")]),D=e=>{const t=p.get(e,"column");return{label:t,value:t}},C=()=>{const e=(()=>{const e=p.filter(A,w("_transformedFieldDataType")),t=p.filter(j,w("_transformedFieldDataType")),a=p.filter(p.filter(o,w("data_type")),Y),i=p.concat(a,e,t);return p.uniqBy([...p.map(i,D),...l],"label")})(),i=p.get(s,"indexCol");return i&&(p.find(e,["value",i])||(a((0,f.FA)({id:t,indexCol:"",error:!0})),u({indexCol:""}))),e},_=(0,i.useMemo)((()=>[{name:"indexCol",label:"Select Timestamp Field",type:"autocomplete",required:!0,selectOptions:C()}]),[p.get(b,"length")]),k=m.Ik().shape({indexCol:m.Yj().required(T.isRequired)});return(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(d.Ay,{container:!0,rowSpacing:Dt,columnSpacing:Dt,children:(0,H.jsx)(d.Ay,{item:!0,xs:4,children:(0,H.jsx)(_e.A,{initialValues:s||{},enableReinitialize:!0,subscribe:u,onSubmit:e=>{},fields:_,size:{xs:6},validationSchema:k,subscribeErrors:g,customUpdate:y})})})})};var _t=a(69413),kt=a(41020),Mt=a(55263),Ft=a(33175),Tt=a(34535),It=a(74802),zt=a(77158);const Ht=(0,Tt.Ay)(l.A)({width:"100%",height:"100%",resize:"none",overflow:"scroll",overflowY:"scroll",fontSize:"13px",bgcolor:"#e9e9e9"}),Et={acceptSuggestionOnCommitCharacter:!0,acceptSuggestionOnEnter:"on",accessibilitySupport:"auto",autoIndent:!1,automaticLayout:!0,codeLens:!0,colorDecorators:!0,contextmenu:!0,cursorBlinking:"blink",cursorSmoothCaretAnimation:!1,cursorStyle:"line",disableLayerHinting:!1,disableMonospaceOptimizations:!1,dragAndDrop:!1,fixedOverflowWidgets:!1,folding:!0,foldingStrategy:"auto",fontLigatures:!1,formatOnPaste:!1,formatOnType:!1,hideCursorInOverviewRuler:!1,highlightActiveIndentGuide:!0,links:!0,mouseWheelZoom:!1,multiCursorMergeOverlapping:!0,multiCursorModifier:"alt",overviewRulerBorder:!0,overviewRulerLanes:2,quickSuggestions:!0,quickSuggestionsDelay:100,readOnly:!1,renderControlCharacters:!1,renderFinalNewline:!0,renderIndentGuides:!0,renderLineHighlight:"all",renderWhitespace:"none",revealHorizontalRightPadding:30,roundedSelection:!0,rulers:[],scrollBeyondLastColumn:5,scrollBeyondLastLine:!1,selectOnLineNumbers:!0,selectionClipboard:!0,selectionHighlight:!0,showFoldingControls:"mouseover",smoothScrolling:!1,suggestOnTriggerCharacters:!0,wordBasedSuggestions:!0,wordSeparators:"~!@#$%^&*()-=+[{]}|;:'\",.<>/?",wordWrap:"off",wordWrapBreakAfterCharacters:"\t})]?|&,;",wordWrapBreakBeforeCharacters:"{([+",wordWrapBreakObtrusiveCharacters:".",wordWrapColumn:80,wordWrapMinified:!0,wrappingIndent:"none",minimap:{enabled:!1}},qt=e=>{let{handleClose:t,evaluationData:a,setEvaluationData:s,transformErrors:r,setTransformErrors:o,closeTransformations:d,setSampleEvent:c}=e;const m=e=>JSON.stringify(e,null,4),h=(0,x.d4)((e=>{var t,a,i,n;return null===e||void 0===e||null===(t=e.wizard)||void 0===t||null===(a=t.pages)||void 0===a||null===(i=a.datasetConfiguration)||void 0===i||null===(n=i.state)||void 0===n?void 0:n.data})),g=(0,x.d4)((e=>{var t,a,i,n,s;return(null===e||void 0===e||null===(t=e.wizard)||void 0===t||null===(a=t.metadata)||void 0===a||null===(i=a.event)||void 0===i?void 0:i.mergedEvent)||(null===e||void 0===e||null===(n=e.wizard)||void 0===n||null===(s=n.pages)||void 0===s?void 0:s.sample_data)||{}}));let f={};p.map(h,(e=>{f=p.merge(f,e)}));const v=p.has(g,"$schema")?{}:g,[y,S]=(0,i.useState)(m(p.isEmpty(f)?v:f)),[j,A]=(0,i.useState)("");(0,i.useEffect)((()=>{const e=setTimeout((()=>{b()}),500);return c(y),()=>{clearTimeout(e)}}),[y,a]);const b=async()=>{let e="";try{e="undefined"!==y&&""!==y?JSON.parse(y):void 0}catch(t){return A(`ERROR IN INPUT DATA: ${t.message}`),void o(!0)}if(a)try{const e=de()(a),t=await e.evaluate(JSON.parse(y));t?(A(m(t)),o(!1)):(A("No match"),o(!0))}catch(t){return A(t.message||String(t)),void o(!0)}else{A("^^ Enter a JSONata expression in the box above ^^"),o(!1)}};return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsxs)(Mt.A,{sx:{justifyContent:"space-between"},children:[(0,H.jsx)(n.A,{variant:"h4",children:"Try JSONata transformations"}),(0,H.jsxs)(l.A,{display:"flex",alignItems:"center",justifyContent:"space-around",children:[(0,H.jsx)(u.A,{sx:{mx:1},size:"medium",onClick:d,children:(0,H.jsxs)(n.A,{variant:"h6",alignItems:"center",fontWeight:"500",display:"flex",children:["Discard and Close ",(0,H.jsx)(It.A,{fontSize:"small"})]})}),(0,H.jsx)(u.A,{sx:{mx:1},size:"medium",onClick:t,children:(0,H.jsxs)(n.A,{variant:"h6",alignItems:"center",fontWeight:"500",display:"flex",children:["Save and Close",(0,H.jsx)(It.A,{fontSize:"small"})]})})]})]}),(0,H.jsx)(l.A,{display:"flex",alignItems:"center",children:(0,H.jsxs)(Ft.A,{split:"vertical",minSize:100,defaultSize:"50%",allowResize:!0,children:[(0,H.jsx)(Ft.A,{split:"horizontal",minSize:100,size:"100%",primary:"second",allowResize:!0,children:(0,H.jsxs)(Ht,{children:[(0,H.jsx)(n.A,{variant:"h5",px:3,py:1,children:"Input data for transformations"}),(0,H.jsx)(zt.Ay,{height:"82vh",language:"json",theme:"clouds",defaultValue:y,onChange:(e,t)=>{S(e)},options:Et})]})}),(0,H.jsxs)(Ft.A,{split:"horizontal",minSize:50,defaultSize:350,children:[(0,H.jsxs)(Ht,{children:[(0,H.jsx)(n.A,{variant:"h5",px:3,py:1,children:"JSONata transformation expressions"}),(0,H.jsx)(zt.Ay,{height:"45vh",language:"jsonata",theme:"clouds",defaultValue:a,options:Et,onChange:(e,t)=>{s(e)}})]}),(0,H.jsxs)(Ht,{children:[(0,H.jsx)(n.A,{variant:"h5",px:3,py:1,children:"Output data post transformations"}),(0,H.jsx)(zt.Ay,{height:"34vh",language:"jsonata",theme:"clouds",value:j,options:Et,onChange:void 0,className:r?"error-class":""})]})]})]})})]})};var Rt=a(14003);const Ot=e=>{const{id:t,data:a,onClose:s,selection:r,setSelection:o,mainDatasetId:u,generateInteractTelemetry:h,selectedValues:g,edit:v=!1,existingTransformationSelections:j,transformation_mode:A}=e,[w,Y]=(0,i.useState)(""),[D,_]=(0,i.useState)(!1),F=(0,x.wA)(),I=(0,x.d4)((e=>{var t;return(null===e||void 0===e||null===(t=e.config)||void 0===t?void 0:t.validationLimit)||{}})),z=e=>F((0,f.FA)({id:t,...e})),[E,q]=(0,i.useState)(null),[R,O]=(0,i.useState)(!1),[$,N]=(0,i.useState)(!0),[B,L]=(0,i.useState)(null),[V,W]=(0,i.useState)({}),Z=(0,x.d4)((e=>{var t,a,i,n;return(null===e||void 0===e||null===(t=e.wizard)||void 0===t||null===(a=t.pages)||void 0===a||null===(i=a.datasetConfiguration)||void 0===i||null===(n=i.state)||void 0===n?void 0:n.data)||{}})),U=Boolean(E);(0,x.d4)((e=>{var t,a,i;return null===e||void 0===e||null===(t=e.wizard)||void 0===t||null===(a=t.pages)||void 0===a||null===(i=a.jsonSchema)||void 0===i?void 0:i.schema}));const K=(0,x.d4)((e=>{var t,a;return null===e||void 0===e||null===(t=e.wizard)||void 0===t||null===(a=t.pages)||void 0===a?void 0:a.additionalFields})),G=(0,S.Wx)({initialValues:g||{column:"",transformation:"",transformation_mode:"Strict"},onSubmit:e=>{ee(e)},validationSchema:m.Ik().shape({column:m.Yj().required(T.isRequired).test("spaceInField",T.containsSpaces,(e=>(0,k.Fq)(e))).max(p.get(I,["transformationFieldMaxLen"])).test("specialChars",T.hasSpecialCharacters,(e=>!(0,k.e3)(e))).test("duplicateFieldName",T.fieldNameAlreadyInUse,(async e=>new Promise((t=>{const a=p.find(j,["column",e]);v&&p.get(G,["initialValues","column"])==e&&t(!0),t(!a)})))).test("columnExists",T.columnNameAlreadyExists,(async e=>new Promise((t=>{t(!p.find(a,["column",e]))})))),transformation:m.Yj().required(T.isRequired).trim(T.whiteSpaceConflict).strict(!0),transformation_mode:m.Yj().required(T.isRequired)}),enableReinitialize:!0});(0,i.useEffect)((()=>{w!==G.values.transformation&&Y(G.values.transformation)}),[G.values]);const X=async()=>{if(h({edata:{id:`${C.add_dataset_transformation}:${t}`}}),ee({}),p.keys(G.errors).length>0)return void F((0,y.z3)({message:T["fill-required-fields"]}));const{column:e,transformation:a,transformation_mode:i}=G.values;if(e&&a&&i){var n,r,l;let t={};try{t=await ge(a,V||Z)}catch(d){return G.setErrors({transformation:null===d||void 0===d?void 0:d.message})}const c={column:e,transformation:a,transformation_mode:i,isModified:!0,_transformationType:"custom",id:(0,jt.A)(),_transformedFieldDataType:null===(n=t)||void 0===n?void 0:n.data_type,_transformedFieldSchemaType:null===(r=t)||void 0===r?void 0:r.schema_type},m={field_key:e,transformation_function:{type:"jsonata",expr:a,datatype:null===(l=t)||void 0===l?void 0:l.data_type,category:"derived"},mode:i,dataset_id:u};v&&(p.set(m,"id",null===g||void 0===g?void 0:g.id),p.set(c,"id",null===g||void 0===g?void 0:g.id)),await(async(e,t)=>{const a=()=>F((0,y.z3)({message:"Error occured saving the transformation config"}));O(!0);try{(await(0,b.iV)({...e,edit:v,existingTransformations:K,selectedValues:g})).data?o((e=>{if(v){const a=p.cloneDeep(e),i=p.findIndex(a,["column",p.get(g,"column")]),n=p.merge(a[i],t);return a.splice(i,1,n),z({selection:a}),a}const a=[...e,t];return z({selection:a}),f.$j})):a()}catch(d){a()}finally{O(!0)}})(m,c),s()}else F((0,y.z3)({message:T["fill-required-fields"]}))},J=[{name:"column",label:"Field Name",type:"text",required:!0},{name:"transformation",label:"Transformation Expression",type:"text",required:!0,helperText:(0,H.jsxs)(H.Fragment,{children:["Ex: $sum(Product.(Price * Quantity)) ",(0,H.jsx)("br",{}),' FirstName & " " & Surname']})}],Q=()=>{D||G.setFieldValue("transformation",w),q(null)},ee=e=>{};return(0,i.useEffect)((()=>{var e,t;(!p.isEmpty(null===G||void 0===G||null===(e=G.values)||void 0===e?void 0:e.column)||!p.isEmpty(null===G||void 0===G||null===(t=G.values)||void 0===t?void 0:t.transformation))&&N(p.keys(B).length>0)}),[B]),(0,i.useEffect)((()=>{L(G.errors)}),[G.errors]),(0,H.jsxs)(H.Fragment,{children:[R&&(0,H.jsx)(M.A,{}),(0,H.jsxs)(l.A,{sx:{p:1,py:1.5,width:"50vw",maxWidth:"100%"},children:[(0,H.jsxs)(Ae.A,{component:l.A,display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,H.jsx)(n.A,{variant:"h5",children:v?"Update Field":"Add Derived Field"}),s?(0,H.jsx)(ut.A,{id:"iconButton","aria-label":"close",onClick:s,sx:{color:e=>e.palette.grey[500]},children:(0,H.jsx)(ct.A,{})}):null]}),(0,H.jsx)(be.A,{children:(0,H.jsx)(P.A,{spacing:2,my:1,children:(0,H.jsx)("form",{onSubmit:G.handleSubmit,children:(0,H.jsxs)(d.Ay,{container:!0,spacing:1,children:[(0,H.jsx)(d.Ay,{item:!0,xs:12,children:J.map((e=>(0,H.jsx)(Fe.A,{title:e.label,children:(0,H.jsx)(c.A,{value:G.values[e.name],onChange:G.handleChange,name:e.name,label:e.label,sx:{m:1},variant:"outlined",fullWidth:!0,autoComplete:"off",onBlur:G.handleBlur,error:Boolean(G.errors[e.name]),helperText:G.touched[e.name]&&G.errors[e.name]&&String(G.errors[e.name])||e.helperText})},e.name)))}),(0,H.jsx)(d.Ay,{item:!0,xs:12,children:(0,H.jsxs)(_t.A,{children:[(0,H.jsx)(n.A,{variant:"h6",fontWeight:"500","aria-label":"form-label",gutterBottom:!0,children:(0,H.jsx)(Rt.A,{id:"transformation-mode-title"})}),(0,H.jsx)(P.A,{direction:"row",spacing:1,children:A.map((e=>{const{value:t,label:a}=e;return(0,H.jsx)(Je.A,{name:"transformation_mode",control:(0,H.jsx)(Qe.A,{onBlur:G.handleBlur,name:"transformation_mode",className:"size-medium",checked:t===p.get(G.values,"transformation_mode"),value:t,onChange:G.handleChange,required:!0,disabled:!1}),label:a},`transformation-${t}`)}))})]})}),(0,H.jsxs)(d.Ay,{item:!0,xs:12,display:"flex",alignItems:"center",justifyContent:"flex-end",children:[(0,H.jsx)(l.A,{mx:2,children:(0,H.jsx)(mt.m,{"data-edataid":C.jsonata,onClick:e=>{q(e.currentTarget)},sx:{width:"auto"},children:(0,H.jsx)(n.A,{variant:"h5",children:"Try Out"})})}),(0,H.jsx)(mt.m,{variant:"contained",onClick:e=>X(),size:"large",disabled:$,sx:{width:"auto"},children:(0,H.jsx)(n.A,{variant:"h5",children:v?"Update":"Add"})})]})]})})})}),(0,H.jsx)(kt.Ay,{id:t,open:U,anchorEl:E,onClose:Q,anchorOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{height:"100%",width:"100%",overflow:"hidden"}},children:(0,H.jsx)(qt,{setSampleEvent:W,handleClose:Q,evaluationData:w,setEvaluationData:Y,setTransformErrors:_,transformErrors:D,closeTransformations:()=>{q(null)}})})]})]})};var Pt=a(16402);const $t=e=>{const{id:t,data:a,onClose:s,selection:r,setSelection:o,actions:d,transformation_mode:c,mainDatasetId:u,generateInteractTelemetry:h,selectedValues:g,edit:v=!1,existingTransformationSelections:S}=e,j=(0,x.wA)(),[A,w]=(0,i.useState)({}),Y=(0,x.d4)((e=>{var t,a,i;return(null===e||void 0===e||null===(t=e.wizard)||void 0===t||null===(a=t.pages)||void 0===a||null===(i=a.dataKey)||void 0===i?void 0:i.dataKey)||""})),D=p.filter(a,(e=>!p.find(r,["column",p.get(e,"column")])&&(!["array","object"].includes(p.get(e,"type"))&&(Y!==p.get(e,"column")&&!p.find(S,["column",p.get(e,"column")]))))),[_,F]=(0,i.useState)({}),I=(0,x.d4)((e=>{var t,a,i,n;return(null===e||void 0===e||null===(t=e.wizard)||void 0===t||null===(a=t.pages)||void 0===a||null===(i=a.datasetConfiguration)||void 0===i||null===(n=i.state)||void 0===n?void 0:n.data)||{}}));(0,x.d4)((e=>{var t,a,i;return null===e||void 0===e||null===(t=e.wizard)||void 0===t||null===(a=t.pages)||void 0===a||null===(i=a.jsonSchema)||void 0===i?void 0:i.schema}));const[z,E]=(0,i.useState)(""),[q,R]=(0,i.useState)(!1),[O,$]=(0,i.useState)(null),[N,B]=(0,i.useState)(null),[L,V]=(0,i.useState)(!0),[W,Z]=(0,i.useState)(!1),U=e=>({label:p.get(e,"column"),value:p.get(e,"column")}),K=v?a:D,G=(0,i.useMemo)((()=>p.map(K,U)),[a]),X=(0,i.useRef)(null),J=e=>j((0,f.FA)({id:t,...e})),[Q,te]=(0,i.useState)(null),ae=Boolean(Q),ie=(0,x.d4)((e=>{var t,a;return null===e||void 0===e||null===(t=e.wizard)||void 0===t||null===(a=t.pages)||void 0===a?void 0:a.transformation}));(0,i.useEffect)((()=>{A.expression!==z&&E(A.expression)}),[A]);const ne=[{name:"column",label:"Select Field",type:"autocomplete",required:!0,selectOptions:G},{name:"transformation",label:"Select Transformation",type:"radio",required:!0,selectOptions:d},{name:"expression",label:"Add Custom Expression",type:"text",dependsOn:{key:"transformation",value:"custom"},required:!0,helperText:(0,H.jsxs)(H.Fragment,{children:["Ex: $sum(Product.(Price * Quantity)) ",(0,H.jsx)("br",{}),' FirstName & " " & Surname']})},{name:"transformation_mode",label:"Transformation Mode",type:"radio",required:!0,selectOptions:c}],se=m.Ik().shape({column:m.Yj().required(T.isRequired),transformation:m.Yj().required(T.isRequired),expression:m.Yj().when("transformation",{is:"custom",then:m.Yj().required(T.isRequired).trim(T.whiteSpaceConflict).strict(!0)}),transformation_mode:m.Yj().required(T.isRequired)}),re=async(e,t)=>{const a=()=>j((0,y.z3)({message:"Error occured saving the transformation config"}));try{Z(!0);(await(0,b.iV)({...e,edit:v,existingTransformations:ie,selectedValues:g})).data?o((e=>{if(v){const a=p.cloneDeep(e),i=p.findIndex(a,["column",null===t||void 0===t?void 0:t.column]),n=p.merge(a[i],t);return a.splice(i,1,n),J({selection:a}),a}const a=[...e,t];return J({selection:a}),a})):a()}catch(i){a()}finally{Z(!1)}},oe=()=>{q||O("expression",z),te(null)},le=async()=>{const e=await(async()=>(0,k.lt)(X,A))();V(!e)};return(0,i.useEffect)((()=>{p.size(A)>0&&le()}),[A]),(0,H.jsxs)(H.Fragment,{children:[W&&(0,H.jsx)(M.A,{}),(0,H.jsxs)(l.A,{sx:{p:1,py:1.5,width:"50vw",height:"auto",maxWidth:"100%"},children:[(0,H.jsxs)(Ae.A,{component:l.A,display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,H.jsx)(n.A,{variant:"h5",children:v?"Update Field Transformation":"Add Field Transformation"}),s?(0,H.jsx)(ut.A,{"aria-label":"close",onClick:s,sx:{color:e=>e.palette.grey[500]},children:(0,H.jsx)(ct.A,{})}):null]}),(0,H.jsx)(be.A,{children:(0,H.jsxs)(P.A,{spacing:2,my:1,children:[(0,H.jsx)(_e.A,{initialValues:g||{transformation_mode:"Strict"},subscribe:w,onSubmit:e=>{},fields:ne,size:{xs:12},validationSchema:se,customUpdate:$,customError:B,ref:X}),(0,H.jsx)(Pt.A,{color:"info",messsage:T.transformationNotSupported,icon:ee.A})]})}),(0,H.jsxs)(we.A,{sx:{px:4},children:["custom"===p.get(A,"transformation")&&(0,H.jsx)(l.A,{mx:2,children:(0,H.jsx)(mt.m,{"data-edataid":C.jsonata,onClick:e=>{te(e.currentTarget)},sx:{width:"auto"},children:(0,H.jsx)(n.A,{variant:"h5",children:"Try Out"})})}),(0,H.jsx)(mt.m,{variant:"contained",autoFocus:!0,onClick:e=>(async()=>{if(h({edata:{id:`${C.add_dataset_transformation}:${t}`}}),L)return void j((0,y.z3)({message:T["fill-required-fields"]}));const{column:e,transformation:i,expression:n,transformation_mode:r}=A,o=p.find(a,["column",e]);if(o){const t=(0,jt.A)();let a={...o,transformation_mode:r,isModified:!0,_transformationType:i,id:t};if("custom"===i&&n){var l,d,c;let t={};try{t=await ge(n,_||I)}catch(m){return N("expression",null===m||void 0===m?void 0:m.message)}a={...a,transformation:n,_transformedFieldDataType:null===(l=t)||void 0===l?void 0:l.data_type,_transformedFieldSchemaType:null===(d=t)||void 0===d?void 0:d.schema_type};const i={...o,...a},s={field_key:e,transformation_function:{type:"jsonata",expr:n,datatype:null===(c=t)||void 0===c?void 0:c.data_type,category:"transform"},mode:r,dataset_id:u};v&&(p.set(s,"id",null===g||void 0===g?void 0:g.id),p.set(i,"id",null===g||void 0===g?void 0:g.id)),await re(s,i)}else{const t={...o,...a,_transformedFieldDataType:"string",_transformedFieldSchemaType:"string"},n={field_key:e,transformation_function:{type:i,expr:e,datatype:"string",category:"transform"},mode:r,dataset_id:u};v&&(p.set(n,"id",null===g||void 0===g?void 0:g.id),p.set(t,"id",null===g||void 0===g?void 0:g.id)),await re(n,t)}s()}else j((0,y.z3)({message:T["fill-required-fields"]}))})(),disabled:L,size:"large",sx:{width:"auto"},children:(0,H.jsx)(n.A,{variant:"h5",children:v?"Update":"Add"})})]}),(0,H.jsx)(kt.Ay,{id:t,open:ae,anchorEl:Q,onClose:oe,anchorOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{height:"100%",width:"100%",overflow:"hidden"}},children:(0,H.jsx)(qt,{setSampleEvent:F,handleClose:oe,evaluationData:z,setEvaluationData:E,setTransformErrors:R,transformErrors:q,closeTransformations:()=>{te(null)}})})]})]})},Nt=e=>{const{id:t,data:a,onClose:s,selection:r,setSelection:o,actions:d,mainDatasetId:c,generateInteractTelemetry:u,selectedValues:h,edit:g=!1,existingTransformationSelections:v,transformation_mode:S,filterAddedSuggestions:j}=e,[A,w]=(0,i.useState)({}),[Y,D]=(0,i.useState)(!1),_=(0,x.wA)(),[k,F]=(0,i.useState)(null),[I,z]=(0,i.useState)(!0),E=(0,x.d4)((e=>{var t,a,i;return(null===e||void 0===e||null===(t=e.wizard)||void 0===t||null===(a=t.pages)||void 0===a||null===(i=a.dataKey)||void 0===i?void 0:i.dataKey)||""})),q=(0,x.d4)((e=>{var t,a;return null===e||void 0===e||null===(t=e.wizard)||void 0===t||null===(a=t.pages)||void 0===a?void 0:a.pii})),R=p.filter(a,(e=>!p.find(r,["column",p.get(e,"column")])&&(!["array","object"].includes(p.get(e,"type"))&&(E!==p.get(e,"column")&&!p.find(v,["column",p.get(e,"column")]))))),O=e=>({label:p.get(e,"column"),value:p.get(e,"column")}),$=g?a:R,N=(0,i.useMemo)((()=>p.map($,O)),[a]),B=e=>_((0,f.FA)({id:t,...e})),L=async()=>{if(u({edata:{id:`${C.add_dataset_transformation}:${t}`}}),p.keys(k).length>0)return void _((0,y.z3)({message:T["fill-required-fields"]}));const{column:e,transformation:i,transformation_mode:n}=A,r=p.find(a,["column",e]);if(r){const t=(0,jt.A)(),a={...r,transformation_mode:n,isModified:!0,_transformationType:i,_transformedFieldDataType:"string",_transformedFieldSchemaType:"string",id:t},l={id:t,field_key:e,transformation_function:{type:i,expr:e,category:"pii",datatype:"string"},mode:n,dataset_id:c};g&&(p.set(l,"id",null===h||void 0===h?void 0:h.id),p.set(a,"id",null===h||void 0===h?void 0:h.id)),await(async(e,t)=>{const a=()=>_((0,y.z3)({message:"Error occured saving the transformation config"}));D(!0);try{(await(0,b.iV)({...e,edit:g,existingTransformations:q,selectedValues:h})).data?o((e=>{if(g){const a=p.cloneDeep(e),i=p.findIndex(a,["column",null===t||void 0===t?void 0:t.column]),n=p.merge(a[i],t);return a.splice(i,1,n),B({selection:a}),a}const a=[...e,t];return B({selection:a}),a})):a()}catch(i){a()}finally{D(!1)}})(l,a),s()}else _((0,y.z3)({message:T["fill-required-fields"]}))};const V=[{name:"column",label:"Select Field",type:"autocomplete",required:!0,selectOptions:N,disabled:function(e,t){return void 0!==e.find((e=>(null===e||void 0===e?void 0:e.isSuggestedField)&&(null===e||void 0===e?void 0:e.column)===(null===t||void 0===t?void 0:t.column)))}(j,h)},{name:"transformation",label:"Select Transformation",type:"radio",required:!0,selectOptions:d},{name:"transformation_mode",label:"Transformation Mode",type:"radio",required:!0,selectOptions:S}],W=m.Ik().shape({column:m.Yj().required(T.isRequired),transformation:m.Yj().required(T.isRequired),transformation_mode:m.Yj().required(T.isRequired)});return(0,i.useEffect)((()=>{!p.isEmpty(A)&&z(p.keys(k).length>0)}),[A]),(0,H.jsxs)(H.Fragment,{children:[Y&&(0,H.jsx)(M.A,{}),(0,H.jsxs)(l.A,{sx:{p:1,py:1.5,width:"50vw",maxWidth:"100%"},children:[(0,H.jsxs)(Ae.A,{component:l.A,display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,H.jsx)(n.A,{variant:"h5",children:g?"Update PII Field":"Add PII Field"}),s?(0,H.jsx)(ut.A,{"aria-label":"close",onClick:s,sx:{color:e=>e.palette.grey[500]},children:(0,H.jsx)(ct.A,{})}):null]}),(0,H.jsx)(be.A,{children:(0,H.jsxs)(P.A,{spacing:2,my:1,children:[(0,H.jsx)(_e.A,{initialValues:h||{transformation_mode:"Strict"},subscribe:w,onSubmit:e=>{},fields:V,size:{xs:12},validationSchema:W,subscribeErrors:F}),(0,H.jsx)(Pt.A,{color:"info",messsage:T.transformationNotSupported,icon:ee.A})]})}),(0,H.jsx)(we.A,{sx:{px:4},children:(0,H.jsx)(mt.m,{variant:"contained",onClick:e=>L(),disabled:I,size:"large",sx:{width:"auto"},children:(0,H.jsx)(n.A,{variant:"h5",children:g?"Update":"Add"})})})]})]})},Bt=[{label:"Mask",component:"",value:"mask"},{label:"Encrypt",component:"",value:"encrypt"}],Lt=[{label:"Strict",component:"",value:I.lT.Strict,selected:!0},{label:"Lenient",component:"",value:I.lT.Lenient}],Vt=[{id:"pii",title:"PII Fields",description:"PII is sensitive information that needs to be protected and kept secure to prevent identity theft, fraud, or other types of harm.  PII fields are often identified and tagged to ensure that appropriate controls are in place to protect the data",component:(0,H.jsx)(Yt,{actions:Bt,transformation_mode:Lt,label:"Add PII Field",dialog:(0,H.jsx)(Nt,{})},"pii"),noGrid:!0,navigation:{next:"transformation"}},{id:"transform",title:"Fields Transformation",description:"Field transformations allows users to manipulate and transform data during ingestion or query time. Custom Expressions specify a set of column transformations to be performed on input data",component:(0,H.jsx)(Yt,{actions:[...Bt,{label:"JSONata",component:"",value:"custom"}],transformation_mode:Lt,label:"Add Transformation",dialog:(0,H.jsx)($t,{})},"transform"),noGrid:!0,navigation:{next:"additionalFields"}},{id:"derived",title:"Derived Fields",description:"Create New Columns by applying custom transformation expressions",component:(0,H.jsx)(Yt,{actions:[{label:"JSONata",component:"",value:"custom"}],transformation_mode:Lt,label:"Add Derived Field",dialog:(0,H.jsx)(Ot,{})},"derived"),noGrid:!0,navigation:{next:"timestamp"}},{id:"timestamp",title:"Timestamp Field",description:"Timestamp Field specifies the column or field that contains the timestamp for each data record being ingested. This enabled our platform to effectively partition, index, and query data based on the timestamps.",componentType:"box",master:!1,component:(0,H.jsx)(Ct,{})}];var Wt=a(53364);const Zt=[{name:"extractionKey",label:"Extraction Key",tooltip:"Path to the events property inside the batch object",type:"text",required:!0,validationSchema:m.Yj().required(T.isRequired).min(2).max(35).test("specialChars",T.hasSpecialCharacters,(e=>!(0,k.e3)(e))).trim(T.whiteSpaceConflict).strict(!0)},{name:"batchId",label:"Batch Identifier",type:"text",required:!0,validationSchema:m.Yj().required(T.isRequired).max(35).test("specialChars",T.hasSpecialCharacters,(e=>!(0,k.e3)(e))).trim(T.whiteSpaceConflict).strict(!0)}],Ut=[{name:"topic",label:"Kafka Topic Name",tooltip:"Name of the kafka topic where raw data is stored",type:"text",required:!0,validationSchema:m.Yj().required(T.isRequired).min(4,T.minLen.replace("{length}","4")).max(50,T.maxLen.replace("{length}","50")).trim(T.whiteSpaceConflict).strict(!0).test("invalidTopic",T.invalidKafkaTopic,(e=>(0,k.e3)(e,k.ex)))},{name:"kafkaBrokers",label:"Comma Seprated List of Broker Urls",tooltip:"The list of brokers seprated by comma that we want to send the messages to",type:"text",required:!0,validationSchema:m.Yj().required(T.isRequired).min(10,T.minLen.replace("{length}","10")).trim(T.whiteSpaceConflict).strict(!0)}],Kt=[{title:"Database Type",formField:[{name:"type",label:"Type",type:"autocomplete",selectOptions:[{label:"MySQL",value:"mysql"},{label:"PostgreSQL",value:"postgresql"}],required:!0,validationSchema:m.Yj().required(T.isRequired)}]}],Gt=[{name:"dedupeKey",label:"Select Dedupe Field",type:"autocomplete",tooltip:"Column based on which you want to enable the dedupe",required:!0,validationSchema:m.Yj().required(T.isRequired),selectOptions:[]}],Xt={input_kafka:Ut,input_jdbc:Kt,input_objectStore:[{title:"Storage Source",formField:[{name:"source",label:"Cloud Service",type:"autocomplete",selectOptions:[{label:"AWS",value:"aws"}],required:!0,validationSchema:m.Yj().required(T.isRequired)},{name:"type",label:"Storage Service",type:"select",dependsOn:{key:"source",value:"aws"},selectOptions:[{label:"S3",value:"s3"}],required:!0,validationSchema:m.Yj().required(T.isRequired)}]}],input_batch:Zt,input_dedupe:Gt,input_validateData:[{name:"validateType",label:"Validation Type",type:"select",tooltip:"Select Appropriate validate type",selectOptions:[{label:"Strict",value:"strict"},{label:"Ignore New Fields",value:"ignore"},{label:"Auto Index New Fields",value:"auto"}]}],advanced_retention:[{name:"retentionPeriod",label:"Duration In Days",tooltip:"Retention Period in Days",type:"number",required:!0}]};var Jt=a(47030);const{spacing:Qt}=Ze.A,ea=e=>{const t=(0,x.wA)(),{id:a,type:n="checkbox",justifyContents:s="flex-start",fields:r,name:o,display:c="column",noChildForm:u=!1}=e,h=(0,x.d4)((e=>p.get(e,["wizard","pages",a])||{})),[g,v]=(0,i.useState)({}),y=(0,i.useRef)([]),j=(0,i.useRef)(null),b=e=>!!p.includes(p.get(h,"formFieldSelection"),p.get(e,"value"))||!0===p.get(e,["selected"]),w=(0,S.Wx)({initialValues:(()=>{const e=p.filter(r,b);return"checkbox"===n?{[o]:p.map(e,"value")}:{[o]:p.get(p.last(e),"value")}})(),onSubmit:e=>{}}),Y=w.values,D=e=>{const i=p.get(Y,[o]);var n;n={formFieldSelection:i,value:{...g},error:e},t((0,f.FA)({id:a,...n}))};(0,i.useEffect)((()=>{(async()=>{let e=!0;if(y.current&&j.current){const t=j.current,a=await t.validateForm(g);e=0===p.size(a)}p.get(Y,[a,"length"])>1&&e||1===p.get(Y,[a,"length"])?D(!1):D({error:!0})})()}),[Y,g]);const C=e=>{w.handleChange(e),v({})},_=e=>{const{name:t,value:a}=e;switch(n){case"checkbox":return(0,H.jsx)(et.A,{name:t,className:"size-medium",checked:p.includes(p.get(Y,t),a),value:a,onChange:C});case"radio":return(0,H.jsx)(Qe.A,{name:t,className:"size-medium",checked:a===p.get(Y,t),value:a,onChange:C});default:return(0,H.jsx)(et.A,{name:t,className:"size-medium",value:a,onChange:C})}},k=e=>(0,H.jsx)(A.A,{title:e,children:(0,H.jsx)(Jt.A,{fontSize:"small",color:"primary"})}),M=e=>{const{name:t,value:a,label:i,description:n,disabled:s=!1}=e;return(0,H.jsxs)(l.A,{display:"flex",alignItems:"center",children:[(0,H.jsx)(Je.A,{name:t,disabled:s,control:_(e),label:i,disableTypography:!0},`${t}-${a}`),n&&k(n)]})};return(0,H.jsx)(H.Fragment,{children:(0,H.jsxs)(d.Ay,{container:!0,rowSpacing:Qt,children:[(0,H.jsx)(d.Ay,{item:!0,xs:12,children:(0,H.jsx)("form",{onSubmit:w.handleSubmit,children:(0,H.jsx)(_t.A,{children:(0,H.jsx)(P.A,{direction:c,spacing:Qt,justifyContent:s,children:r.map(M)})})})}),(()=>{const t=p.get(Y,[o]),a=Array.isArray(t)?t:[t];return p.map(a,(t=>{const a=p.find(r,["value",t]);if(!a)return null;const{form:n,description:s,component:o,formComponent:l,topComponent:c,value:u,...g}=a;y.current=n;const x={};p.forEach(n,(e=>{const t=p.get(e,"validationSchema");t&&(x[e.name]=t)}));const f=m.Ik().shape(x);return(0,H.jsxs)(H.Fragment,{children:[c&&(0,H.jsx)(d.Ay,{item:!0,sm:12,children:c}),n&&(0,H.jsx)(d.Ay,{item:!0,sm:12,children:(0,H.jsx)(_e.A,{subscribe:v,initialValues:{type:u,...p.get(h,"value")},onSubmit:e=>{},fields:n,size:{sm:4,xs:4,lg:4},formComponent:l&&i.cloneElement(l,{...e}),validationSchema:f,ref:j,debounce:1e3})}),o&&(0,H.jsx)(d.Ay,{item:!0,sm:12,children:o})]})}))})()]})})},{spacing:ta}=Ze.A,aa=e=>{const{id:t="dataKey",description:a}=e,n=(0,x.wA)(),s=(0,x.d4)((e=>p.get(e,["wizard","pages",t]))),r=(0,x.d4)((e=>null===e||void 0===e?void 0:e.wizard)),o=p.get(r,"pages.jsonSchema"),[l,c]=(0,i.useState)(null),u=Object.entries(p.get(o,["schema","properties"])).map((e=>{let[t,a]=e;return{label:t,value:t}})),h=[...p.get(r,"pages.pii.selection",[]),...p.get(r,"pages.transform.selection",[])]||[],[g,v]=(0,i.useState)({}),y=p.filter(u,(e=>!p.find(h,["column",p.get(e,"value")])));(0,i.useEffect)((()=>{const e=p.get(g,"dataKey");var a;e&&(a={dataKey:e},n((0,f.FA)({id:t,...a,error:p.keys(l).length>0})))}),[g]),(0,i.useEffect)((()=>{n((0,f.FA)({id:t,...s||{},error:!p.get(s,"dataKey")}))}),[]);const S=[{name:"dataKey",label:"Select Data key Field",type:"autocomplete",required:!0,selectOptions:y}],j=m.Ik().shape({dataKey:m.Yj().required(T.isRequired)});return(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(d.Ay,{container:!0,rowSpacing:ta,columnSpacing:ta,children:(0,H.jsx)(d.Ay,{item:!0,xs:4,children:(0,H.jsx)(_e.A,{initialValues:s||{},subscribe:v,onSubmit:e=>{},fields:S,size:{xs:6},subscribeErrors:c,validationSchema:j})})})})};var ia=a(41402),na=a(78293),sa=a(18666);const ra=async e=>{const{state:t,type:a}=e,i=(e=>h().get(e,["wizard","pages","datasetConfiguration","state","masterId"]))(t),n={connector_id:a,id:`${i}_${a}`};await oa(n,i)},oa=async(e,t)=>{const{store:i}=a(39939),n=i.getState(),s=h().get(n,"wizard"),r=h().get(s,"pages.datasetConfiguration.state.config.versionKey"),o={connectors_config:[{value:{...e},action:"remove"}],version_key:h().get(b.sr,["version_keys",t])||r||"",dataset_id:t},l=(0,k.Fj)({request:h().omit(o,["published_date"]),apiId:"api.datasets.update"}),d=await sa.LV.patch(`${na.A.updateDataset}`,l),c=h().get(d,"data.result.version_key")||"";return h().set(b.sr,"version_keys",{[t]:c}),d};var la=a(24699);const da=e=>{const{connectorInfo:t,disabled:a,setConnectionStatus:n}=e,s=(0,x.wA)(),[r,o]=(0,i.useState)(!1),l=async e=>{o(!0);try{const{connector_type:t,...a}=e||{};await(async e=>await sa.LV.post(`${na.A.testConnection}`,e.config))({type:t,config:a}),s((0,y.kX)({message:"Connection established successfully"})),o(!1),n(!0)}catch(t){s((0,y.z3)({message:"Failed to establish connection."})),o(!1),n(!1)}};return(0,H.jsxs)(H.Fragment,{children:[r&&(0,H.jsx)(M.A,{}),(0,H.jsx)(la.A,{onClick:e=>l(t),variant:"outlined",color:"primary",disabled:a,loading:r,startIcon:(0,H.jsx)(ia.A,{}),loadingPosition:"end",sx:{fontWeight:500,verticalAlign:"top"},size:"large",children:"Test connection"})]})};var ca=a(67407);const ua=e=>{const{formData:t,type:a,formErrors:s,actionHandler:r,edit:o}=e,[l,c]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{c(!1)}),[t]),(0,H.jsxs)(H.Fragment,{children:[!s&&!l&&(0,H.jsx)(Me.A,{severity:"info",sx:{marginBottom:"1rem",lineHeight:0},children:(0,H.jsx)(n.A,{variant:"caption",fontSize:13,children:"Add/Update Connectors config on a successful test connection"})}),(0,H.jsxs)(d.Ay,{container:!0,justifyContent:"flex-end",spacing:2,alignItems:"center",children:[(0,H.jsx)(d.Ay,{item:!0,display:"flex",children:(0,H.jsx)(da,{connectorInfo:{...t,...a&&{type:a}},disabled:s,setConnectionStatus:c})}),(0,H.jsx)(d.Ay,{item:!0,display:"flex",children:(0,H.jsx)(u.A,{variant:"contained",onClick:e=>r(e),size:"large",disabled:s||!l,sx:{py:"0.8rem",px:"1.2rem"},startIcon:o?(0,H.jsx)(ca.A,{}):(0,H.jsx)(ke.A,{}),children:(0,H.jsx)(n.A,{variant:"h6",children:o?"Update":"Add"})})})]})]})},ma=e=>{const{form:t,onClose:a,setMainFormValue:s,addConnector:r,edit:o,existingState:l}=e,c=h().get(l,["value","kafka-connector-1.0.0"])||{};let u={};if(!h().isEmpty(c)){const{topic:e,source_kafka_topic:t,kafkaBrokers:a,source_kafka_broker_servers:i}=c;u={topic:e||t,kafkaBrokers:a||i}}const[p,g]=(0,i.useState)(u),f=(0,i.useRef)(null),v=(0,x.d4)((e=>null===e||void 0===e?void 0:e.wizard)),[y,S]=(0,i.useState)(!0),j=e=>{s(null);const t=h().get(l,"formFieldSelection")||[],i=h().get(v,"pages.datasetConfiguration.state.masterId");r({formFieldSelection:h().uniq(h().concat(t,["kafka-connector-1.0.0"])),value:{...l.value,"kafka-connector-1.0.0":{...p,id:`${i}_kafka`}},error:!1},p),a()},A=async()=>{const e=await(async()=>(0,k.lt)(f,p))();S(!e)};(0,i.useEffect)((()=>{h().size(p)>0&&A()}),[p]);return(()=>{const e={};h().forEach(t,(t=>{const a=h().get(t,"validationSchema");a&&(e[t.name]=a)}));const a=m.Ik().shape(e);return(0,H.jsx)(d.Ay,{item:!0,sm:12,children:(0,H.jsxs)(d.Ay,{container:!0,spacing:2,children:[(0,H.jsx)(d.Ay,{item:!0,sm:12,children:(0,H.jsx)(Me.A,{severity:"info",sx:{marginY:"0.5rem",lineHeight:0},children:(0,H.jsx)(n.A,{variant:"caption",fontSize:13,children:"This connector will enable businesses to analyze and gain insights from live data streams, opening up real-time decision-making and monitoring opportunities"})})}),(0,H.jsx)(d.Ay,{item:!0,sm:12,children:(0,H.jsx)(_e.A,{subscribe:g,initialValues:{connector_type:"kafka-connector-1.0.0",...p}||{},onSubmit:e=>{},fields:t,size:{sm:4,xs:4,lg:6},validationSchema:a,ref:f})}),(0,H.jsx)(d.Ay,{item:!0,sm:12,children:(0,H.jsx)(ua,{formData:p,formErrors:y,actionHandler:j,edit:o})})]})})})()};var pa=a(78240),ha=a(51544),ga=a(42497);const{spacing:xa}=Ze.A,fa={title:"Delete Connector",content:"Are you sure you want to delete this connector ?"},va=e=>{const t=(0,x.wA)(),{id:s,label:r,dialog:o,fields:l=[],name:c}=e,m=(0,x.d4)((e=>h().get(e,["wizard"])||{})),p=h().get(m,["pages",s]),g=(0,x.d4)((e=>e)),[v,j]=(0,i.useState)(!1),[A,w]=(0,i.useState)(!1),[Y,D]=(0,i.useState)({}),[C,_]=(0,i.useState)(!1),M=h().get(p,"formFieldSelection")||[],[F,T]=(0,i.useState)(!1),[I,z]=(0,i.useState)(""),E=e=>!!h().includes(M,h().get(e,"value"))||!0===h().get(e,["selected"]),q=(0,S.Wx)({initialValues:(()=>{const e=h().filter(l,E);return{[c]:h().map(e,"value")}})(),onSubmit:e=>{}}).values,R=async(e,i)=>{try{if(t((0,f.FA)({id:s,...e})),i){const e=h().get(m,"pages.datasetConfiguration.state.config.dataset_id"),{connector_type:t,source:n,id:s,...r}=i,o={id:`${e}_${t}`,connector_id:`${t}`,connector_config:{...r},version:"v2"};await(async(e,t)=>{const{store:i}=a(39939),n=((e,t)=>{const{connector_config:a,connector_id:i,version:n}=e;if("v2"==n){if("kafka-connector-1.0.0"===i){const{kafkaBrokers:e,topic:i}=a;return{source_kafka_broker_servers:e,source_kafka_topic:i,source_kafka_auto_offset_reset:"EARLIEST",source_kafka_consumer_id:`${t}_kafka-connector-consumer`,source_data_format:"json"}}return a}return a})(e,t),s={...e,connector_config:n},r=i.getState(),o=h().get(r,"wizard"),l=h().get(o,"pages.datasetConfiguration.state.config.versionKey"),d={connectors_config:[{value:{...s},action:"upsert"}],version_key:h().get(b.sr,["version_keys",t])||l||"",dataset_id:t},c=(0,k.Fj)({request:h().omit(d,["published_date"]),apiId:"api.datasets.update"}),u=await sa.LV.patch(`${na.A.updateDataset}`,c),m=h().get(u,"data.result.version_key")||"";return h().set(b.sr,"version_keys",{[t]:m}),u})(o,e)}}catch(n){t((0,y.z3)({message:"Failed to add the connector"}))}},O=e=>{const t=h().get(p,"formFieldSelection")||h().get(q,[c]);R({formFieldSelection:t,value:h().get(p,"value"),error:e},null)};(0,i.useEffect)((()=>{(async()=>{const e=!!h().isUndefined(h().get(p,["value","jdbc"]))||h().get(p,["value","jdbc","authenticationMechanism","username"],!1)&&h().get(p,["value","jdbc","authenticationMechanism","password"],!1),t=!!h().isUndefined(h().get(p,["value","object"]))||h().get(p,["value","object","authenticationMechanism","config","access_key"],!1)&&h().get(p,["value","object","authenticationMechanism","config","secret_key"],!1),a=!!h().isUndefined(h().get(p,["value","kafka"]))||h().get(p,["value","kafka","topic"],!1)&&h().get(p,["value","kafka","kafkaBrokers"],!1);let i=e&&a&&t;q[s].length>1&&i||1===q[s].length?O(!1):O({error:!0})})()}),[h().get(p,"value")]);const P=async()=>{await(async e=>{try{const a=h().filter(M,(t=>t!==e)),i=h().get(p,"value")||{},n=h().omit(i,[e]);await ra({state:g,type:e}),R({formFieldSelection:a,value:n},null),t((0,y.kX)({message:`${h().capitalize((0,ha.I)(e))} connector config deleted successfully`}))}catch(a){t((0,y.z3)({message:"Failed to delete the connector"}))}})(I)},N=e=>{const{value:t,disabled:a,label:i,icon:s,description:r}=e,o=h().get(p,["value",t])||{},l=(e=>{const t=h().pick(e,["topic","kafkaBrokers","databaseName","tableName","source","bucket","prefix","type","source_kafka_broker_servers","source_kafka_topic"]);return h().omitBy(t,(e=>h().isUndefined(e)||""===e))})(o),c=[{name:"edit",label:"Edit",color:"primary",onClick:e=>(e=>{w(!0),j(!0);const t=h().get(p,["value",e])||{};D(t)})(t),disabled:a,icon:(0,H.jsx)(ca.A,{})},{name:"delete",label:"Delete",color:"primary",onClick:()=>(e=>{T(!0),z(e)})(t),disabled:a,icon:(0,H.jsx)(pa.A,{})}],u=()=>{const e=(0,k.YO)(l);return(0,H.jsxs)(H.Fragment,{children:[h().map(e,(e=>{const{key:t,value:a}=e;return(0,H.jsx)(d.Ay,{item:!0,display:"flex",marginX:1,children:(0,H.jsx)($.A,{variant:"outlined",label:`${h().capitalize((0,ha.I)(t))} : ${(0,ha.I)(a)}`})})})),!h().size(e)&&(0,H.jsxs)(n.A,{variant:"caption",children:["(",r,")"]})]})},m=h().omitBy(o,((e,t)=>l.hasOwnProperty(t)&&l[t]===e)),g=(e=>{const t=["authenticationMechanism.password","authenticationMechanism.username","authenticationMechanism.encrypted","connector_type","authenticationMechanism.config.access_key","authenticationMechanism.config.secret_key","id","prefix","fileFormat.compressed"];return h().filter(e,(e=>{let{key:a}=e;return!t.includes(a)}))})((0,k.YO)(m)),x=h().size(g)>0&&!A&&!F;return(0,H.jsxs)(G.A,{expanded:C===t&&x,onChange:(f=t,(e,t)=>{_(!!t&&f)}),children:[(0,H.jsx)(X.A,{"aria-controls":"panel1d-content",id:"panel1d-header",expandIcon:0===h().size(g)?(0,H.jsx)("div",{style:{marginRight:"1.5rem"}}):(0,H.jsx)(ga.A,{}),children:(0,H.jsxs)(d.Ay,{container:!0,justifyContent:"space-between",alignItems:"center",children:[(0,H.jsx)(d.Ay,{item:!0,display:"flex",children:(0,H.jsxs)(d.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,H.jsx)(d.Ay,{item:!0,display:"flex",children:s}),(0,H.jsx)(d.Ay,{item:!0,display:"flex",children:(0,H.jsx)(n.A,{variant:"body1",fontWeight:450,children:i})}),(0,H.jsx)(d.Ay,{item:!0,display:"flex",children:u()})]})}),(0,H.jsx)(d.Ay,{item:!0,display:"flex",sx:{marginX:"2rem"},children:h().map(c,(e=>{const{label:t,name:a,onClick:i,color:n,disabled:s,icon:r}=e;return(0,H.jsx)(Fe.A,{title:t,children:(0,H.jsx)(ut.A,{id:a,onClick:i,color:n,size:"medium",disabled:s,children:r})})}))})]})}),(0,H.jsx)(J.A,{children:(0,H.jsx)(d.Ay,{container:!0,direction:"row",children:(0,H.jsx)(d.Ay,{item:!0,xs:12,marginLeft:1,children:h().map(g,(e=>{const{key:t,value:a}=e||{};return(0,H.jsxs)(d.Ay,{container:!0,direction:"row",margin:1,alignItems:"center",children:[(0,H.jsx)(d.Ay,{item:!0,xs:2,children:(0,H.jsx)(n.A,{color:"black",variant:"body1",fontWeight:500,children:h().capitalize((0,ha.I)(t))})}),(0,H.jsx)(d.Ay,{item:!0,xs:10,children:(0,H.jsx)(n.A,{color:"black",variant:"body1",children:a})})]})}))})})})]});var f},B=()=>{j(!1),w(!1),D({}),_(!1)},L=()=>{T(!1),_(!1)};return(0,H.jsx)(H.Fragment,{children:(0,H.jsxs)(d.Ay,{container:!0,rowSpacing:0,columnSpacing:xa,children:[(()=>{const e=h().filter(l,(e=>M.includes(e.value)));return(0,H.jsx)(d.Ay,{item:!0,xs:12,children:h().map(e,N)})})(),(0,H.jsx)(d.Ay,{item:!0,xs:12,textAlign:"end",my:2,children:(0,H.jsx)(u.A,{onClick:e=>{j(!0),D({})},disabled:(()=>{const e=h().filter(l,(e=>!h().includes(M,e.value)));return h().isEmpty(e)})(),startIcon:(0,H.jsx)(yt.A,{fontSize:"large"}),children:(0,H.jsx)(n.A,{variant:"body2",fontWeight:"500",children:r})})}),(0,H.jsx)(d.Ay,{item:!0,xs:12,children:(0,H.jsx)(je.A,{maxWidth:"md",fullWidth:!0,open:v,onClose:e=>j(!1),children:i.cloneElement(o,{id:s,fields:l,addConnector:R,onClose:B,edit:A,toEditValue:Y,existingState:p,...e})})}),(0,H.jsx)(V.A,{open:F,handleClose:L,context:fa,action:P})]})})};var ya=a(62878);const{spacing:Sa}=Ze.A,ja=e=>{const{fields:t,onClose:a,edit:s,toEditValue:r,existingState:o}=e,[c,u]=(0,i.useState)(p.pick(r,"connector_type")),m=e=>{if(!0===p.get(e,["selected"]))return!1;if(s)return e.value===p.get(r,"connector_type");return!(p.get(o,"formFieldSelection")||[]).includes(e.value)},h=[{name:"connector_type",label:"Source Type",type:"select",required:!0,selectOptions:(g=t,p.filter(g,m))}];var g;const x=n=>{const r=t.find((e=>{var t;return null===(t=n.connector_type)||void 0===t?void 0:t.includes(e.value)}));return r?i.cloneElement(p.get(r,"component"),{edit:s,onClose:a,setMainFormValue:u,mainFormValue:c,existingState:o,...e}):null};return(0,H.jsxs)(l.A,{sx:{p:1,py:1.5,maxWidth:"100%"},children:[(0,H.jsx)(Ae.A,{component:l.A,alignItems:"center",children:(0,H.jsx)(H.Fragment,{children:(0,H.jsxs)(d.Ay,{container:!0,display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,H.jsx)(d.Ay,{item:!0,display:"flex",children:(0,H.jsxs)(d.Ay,{container:!0,display:"flex",alignItems:"center",spacing:Sa,children:[(0,H.jsx)(d.Ay,{item:!0,display:"flex",children:(0,H.jsx)(n.A,{variant:"h5",children:s?"Update Connector":"Add Connector"})}),(0,H.jsx)(d.Ay,{item:!0,display:"flex",children:(0,H.jsx)(A.A,{title:(0,H.jsxs)(l.A,{children:[(0,H.jsx)(n.A,{variant:"caption",fontSize:13,children:"Source connectors allow businesses to import data into the Obsrv platform. To start with, we would like to extend the support for:"}),(0,H.jsxs)("ul",{children:[(0,H.jsx)("li",{children:"Relational DB Source Connector"}),(0,H.jsx)("li",{children:"Blob / Object Store Source Connector"}),(0,H.jsx)("li",{children:"Data Stream Source Connector"}),(0,H.jsx)("li",{children:"Neo4j Connector"}),(0,H.jsx)("li",{children:"Debezium Connector"})]})]}),children:(0,H.jsx)(ya.A,{style:{fontSize:"1.25rem"}})})})]})}),(0,H.jsx)(d.Ay,{item:!0,display:"flex",children:(0,H.jsx)(ut.A,{"aria-label":"close",onClick:a,children:(0,H.jsx)(ct.A,{})})})]})})}),(0,H.jsx)(be.A,{children:(0,H.jsxs)(d.Ay,{container:!0,children:[(0,H.jsx)(d.Ay,{item:!0,xs:12,margin:1,children:(0,H.jsx)(_e.A,{initialValues:c,subscribe:u,onSubmit:e=>{},fields:h,size:{xs:12}})}),(0,H.jsx)(d.Ay,{item:!0,xs:12,marginX:1,children:c&&x(c)})]})})]})};var Aa=a(71558),ba=a(77720);const wa=()=>(0,H.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",children:(0,H.jsx)("path",{fill:"currentColor",d:"M15.54 12.97c-.68 0-1.3.25-1.78.67l-1.29-.75c.09-.29.13-.6.13-.92c0-.32-.04-.63-.1-.92l1.23-.73c.48.44 1.12.68 1.81.68c1.49 0 2.7-1.19 2.7-2.68s-1.21-2.69-2.7-2.69s-2.7 1.21-2.7 2.7c0 .17.02.37.05.55l-1.25.72c-.43-.45-1-.78-1.64-.95V7.26a2.705 2.705 0 0 0 1.88-2.57C11.88 3.2 10.67 2 9.18 2C7.69 2 6.5 3.2 6.5 4.69c0 1.2.76 2.21 1.84 2.57v1.4a3.421 3.421 0 0 0-2.58 3.31c0 1.6 1.1 2.94 2.58 3.31v1.45A2.692 2.692 0 0 0 6.5 19.3c0 1.49 1.19 2.7 2.68 2.7c1.49 0 2.7-1.21 2.7-2.7c0-1.2-.79-2.22-1.88-2.57v-1.44c.64-.16 1.2-.49 1.64-.94l1.26.73c-.04.19-.06.38-.06.58c0 1.49 1.21 2.7 2.7 2.7s2.7-1.21 2.7-2.7s-1.21-2.69-2.7-2.69m0-5.97c.74 0 1.33.59 1.33 1.32s-.59 1.34-1.33 1.34s-1.33-.6-1.33-1.34S14.8 7 15.54 7M7.85 4.69c0-.74.59-1.34 1.33-1.34c.74 0 1.32.6 1.32 1.34s-.58 1.34-1.32 1.34c-.74 0-1.33-.6-1.33-1.34M10.5 19.3c0 .74-.58 1.34-1.32 1.34c-.74 0-1.33-.6-1.33-1.34c0-.74.59-1.34 1.33-1.34c.74 0 1.32.6 1.32 1.34m-1.32-5.41a1.92 1.92 0 1 1 .001-3.841a1.92 1.92 0 0 1-.001 3.841M15.54 17c-.74 0-1.33-.6-1.33-1.34s.59-1.33 1.33-1.33s1.33.6 1.33 1.33S16.28 17 15.54 17Z"})}),Ya=()=>(0,H.jsx)(ba.A,{component:wa}),Da={name:"dataFormat",justifyContents:"flex-start",type:"checkbox",fields:[{name:"dataFormat",label:"Individual Events",value:"no",required:!0,selected:!0,disabled:!0,description:"Individual event mode is always enabled.",form:null},{name:"dataFormat",label:"Batch Mode",value:"yes",required:!0,form:Xt.input_batch,description:"Select this option if you wish to send multiple events at once for this dataset.",topComponent:(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(u.A,{"data-edataid":`${C.download_sample_batch_file}`,onClick:e=>{(0,k.D1)({data:{id:"observations",events:[{eid:"IMPRESSION",ets:1672657002221,ver:"3.0",mid:"IMPRESSION:2b5834e196f485c17c4e49d292af43c0",actor:{id:"0c45959486f579c24854d40a225d6161",type:"User"},context:{channel:"01268904781886259221",pdata:{id:"staging.diksha.portal",ver:"5.1.0",pid:"sunbird-portal"},env:"public",sid:"23850c90-8a8c-11ed-95d0-276800e1048c",did:"0c45959486f579c24854d40a225d6161",cdata:[],rollup:{l1:"01268904781886259221"},uid:"anonymous"},object:{},tags:["01268904781886259221"],edata:{type:"view",pageid:"login",subtype:"pageexit",uri:"https://staging.sunbirded.org/auth/realms/sunbird/protocol/openid-connect/auth?client_id=portal&state=254efd70-6b89-4f7d-868b-5c957f54174e&redirect_uri=https%253A%252F%252Fstaging.sunbirded.org%252Fresources%253Fboard%253DState%252520(Andhra%252520Pradesh)%2526medium%253DEnglish%2526gradeLevel%253DClass%2525201%2526%2526id%253Dap_k-12_1%2526selectedTab%253Dhome%2526auth_callback%253D1&scope=openid&response_type=code&version=4",visits:[]},syncts:1672657005814,"@timestamp":"2023-01-02T10:56:45.814Z",flags:{ex_processed:!0}},{eid:"LOG",ets:1672656997928,ver:"3.0",mid:"50263f0f-c2d5-4b15-95f4-5384c537f6cc",actor:{id:"internal",type:"Consumer"},context:{channel:"0126796199493140480",pdata:{id:"staging.sunbird.learning.service",pid:"learner-service",ver:"5.0.0"},env:"Organisation",cdata:[{id:"50263f0f-c2d5-4b15-95f4-5384c537f6cc",type:"Request"}],rollup:{}},edata:{level:"info",type:"Api_access",message:"",params:[{method:"POST"},{url:"/v1/org/search"},{duration:0},{status:"OK"}]}}]}},"sampleBatchConfig.json")},variant:"text",sx:{my:.5,fontSize:"1.25rem"},startIcon:(0,H.jsx)(Wt.A,{fontSize:"inherit"}),children:(0,H.jsx)(n.A,{variant:"h6",children:"Download Sample Batch Event"})})})}]},Ca={label:"Add Connector",name:"dataSource",fields:[{name:"dataSource",label:"API",value:"api",icon:(0,H.jsx)(Aa.A,{}),selected:!0,required:!0,disabled:!0,description:"API input is by enabled for all datasets.",form:null},{name:"dataSource",label:"Events (Kafka)",value:"kafka-connector-1.0.0",icon:(0,H.jsx)(Ya,{}),required:!0,form:Xt.input_kafka,description:"Load streaming data in real-time from Apache Kafka. Configure topic name and list of Kafka brokers in the form: <BROKER_1>:<PORT_1>,<BROKER_2>:<PORT_2>,...",component:(0,H.jsx)(ma,{form:Xt.input_kafka})}]},_a=[{id:"dataKey",title:"Data key",description:"Select the key from your data for denormalization.",component:(0,H.jsx)(aa,{}),master:!0,componentType:"box",navigation:{next:"dataSource"}},{id:"dataSource",title:"Input Data Sources",description:"Read data from a wide variety of data sources. Batch and Real time data integration.",component:(0,H.jsx)(va,{dialog:(0,H.jsx)(ja,{}),...Ca},"dataSource"),noGrid:!0,navigation:{next:"dataFormat"}},{id:"dataFormat",title:"Input Data Formats",description:"Decide how the data is ingested into the system.",component:(0,H.jsx)(ea,{...Da},"dataFormat")}],{spacing:ka}=Ze.A,Ma=e=>{const t=(0,x.wA)(),{id:a,question:n,options:s}=e,r=(0,x.d4)((e=>p.get(e,["wizard","pages",a])||{})),{questionSelection:o,optionSelection:l}=r,[c,u]=(0,i.useState)(o||{}),[h,g]=(0,i.useState)(l||{}),v=p.get(c,p.get(n,"name")),[y,S]=(0,i.useState)({}),j=(0,i.useRef)(null),A=(0,x.d4)((e=>null===e||void 0===e?void 0:e.wizard)),b=p.get(A,"pages.columns.state.schema")||[],w=e=>{if(!0===p.get(e,"isDeleted"))return!1;const t=p.get(e,"data_type");return!p.includes(["date","date-time","epoch","double","boolean","bigdecimal","float","object","array"],t)},Y=(0,i.useMemo)((()=>p.map(p.filter(b,w),(e=>{const t=p.get(e,"column");return{label:t,value:t,type:p.get(e,"type")}}))),[]),D=(e,i)=>{t((0,f.FA)({id:a,...e,error:i})),!i&&!p.isEmpty(h)&&p.size(y)};return(0,i.useEffect)((()=>{p.isEqual(o,c)||g({})}),[c]),(0,i.useEffect)((()=>{(()=>{const e=p.get(s,[v]);if(e){const{form:t,description:a,size:i={sm:6,xs:6,lg:6},dedupOptions:n=!1}=e,s={};p.forEach(t,(e=>{n&&(e.selectOptions=Y);const t=p.get(e,"validationSchema");t&&(s[e.name]=t)}));const r=m.Ik().shape(s);return S({form:t,description:a,size:i,validationSchemas:r}),!0}return S({}),!1})()?(async()=>{let e=!0;if(j.current){const t=j.current,a=await t.validateForm(h);e=0===p.size(a)}D({questionSelection:c,optionSelection:h},!e&&{error:!0})})():D({questionSelection:c,optionSelection:h},!1)}),[v,h]),(0,H.jsx)(H.Fragment,{children:(0,H.jsxs)(d.Ay,{container:!0,rowSpacing:ka,children:[(0,H.jsxs)(d.Ay,{item:!0,xs:6,children:[" ",(0,H.jsx)(_e.A,{initialValues:c,subscribe:u,onSubmit:e=>{},fields:[n]})]}),p.get(y,"form")?(0,H.jsx)(d.Ay,{item:!0,sm:12,children:(0,H.jsx)(_e.A,{subscribe:g,initialValues:h,onSubmit:e=>{},fields:p.get(y,"form"),size:p.get(y,"size"),validationSchema:p.get(y,"validationSchemas"),ref:j})}):null]})})};var Fa=a(57284);const Ta={question:{name:"dedupe",label:"Dedupe Events ?",type:"checkbox",required:!0,selectOptions:[{label:"Enable Deduplication",value:"yes"}]},options:{yes:{dedupOptions:!0,form:Xt.input_dedupe,description:"Select Dedupe properties"},no:{form:null,description:null}}},Ia={advanced:ft,field:Vt,input:_a,processing:[{id:"dataValidation",title:"Data Validation",description:"Data Validation Type",componentType:"box",component:(0,H.jsx)(ea,{pageId:"processing",type:"radio",justifyContents:"flex-start",name:"dataValidation",noChildForm:!0,fields:[{name:"dataValidation",label:"Strict",value:"Strict",selected:!0,required:!0,disabled:!1,description:"Strict data validation of all fields, data will be marked as invalid if not adhering to schema",form:null},{name:"dataValidation",label:"Discard New Fields",value:"IgnoreNewFields",required:!0,disabled:!1,form:null,description:"Validate only known fields, skip unknown fields"}]}),navigation:{next:"dedupe"}},{id:"dedupe",title:"Dedupe Events",description:"Dedupe refers to the process of identifying and removing duplicate or redundant data entries within a dataset",component:(0,H.jsx)(Ma,{pageId:"processing",transform:(e,t)=>{const a=p.get(t,"redux.jsonSchema.data.schema");return a?((0,w.E4)(a),e):e},...Ta}),navigation:{next:"denorm"}},{id:"denorm",title:"Data Denormalization",description:"Data denormalization is a technique used in database design where the data in a database is intentionally made less normalized. In other words, instead of having data organized into many separate tables that are related to each other by keys, the data is combined into fewer tables.",component:(0,H.jsx)(Fa.A,{pageId:"processing"})}]};var za=a(35475);const Ha=e=>{let{handleNext:t,handleBack:a,index:n,section:s,master:r,edit:o,generateInteractTelemetry:l}=e;const c=p.get(Ia,s)||[],u=(0,x.d4)((e=>null===e||void 0===e?void 0:e.wizard)),m=p.get(u,"pages.columns.state.schema")||[],[h,g]=(0,i.useState)(!1),f=e=>(t,a)=>{g(!!a&&e)},[v]=((0,x.wA)(),(0,za.ok)()),y=p.get(ye.A,[r?"masterdataset":"dataset",o?"edit":"create"]),S=p.get(ye.A,[r?"masterdataset":"dataset","pages",s]);(0,ve.A)({type:"view",pageid:`${y}:${S}`});const j=c.filter((e=>{const t=v.get("master");if("master"in e){const a=e.master;return!t&&!a||(!a&&"false"==t||a.toString()===t)}return!0}));return(0,H.jsx)(H.Fragment,{children:(0,H.jsxs)(d.Ay,{container:!0,children:[(0,H.jsx)(d.Ay,{item:!0,xs:12,children:j.map(((e,t)=>(0,H.jsx)(Ke,{expanded:h,setExpanded:g,handleChange:f,...e,data:m,section:t,index:n,master:r,generateInteractTelemetry:l})))}),(0,H.jsx)(d.Ay,{item:!0,xs:12,children:(0,H.jsx)(se.A,{showPrevious:!0,pageId:"section:config",master:r,section:s,gotoNextSection:()=>{(0,b.y7)({}),t()},gotoPreviousSection:()=>{a()},nextDisabled:!(()=>{const e=p.cloneDeep(null===u||void 0===u?void 0:u.pages)||{},t=p.map(j,"id"),a=p.map(t,(t=>p.get(e[t],"error")));return p.every(a,(e=>!1===e||void 0===e))})(),edit:o,generateInteractTelemetry:l})})]})})};var Ea=a(43482),qa=a(60028);const Ra=e=>{const{setFiles:t,setOpenDailog:a,setCheckValidation:s,form:r,handleNameChange:o,onSubmit:m,isLiveExists:p}=e,[g,x]=(0,i.useState)({}),f=[{name:"importType",label:"Select import options",type:"radio",required:!0,selectOptions:[{label:"Import as new dataset",component:"",value:"new"},...p?[]:[{label:"Overwrite the Dataset",component:"",value:"overwrite"}]]}];return(0,i.useEffect)((()=>{const{importType:e}=g;"new"===e&&(r.setFieldValue("name",""),r.setFieldValue("dataset_id",""),s(!0))}),[g]),(0,H.jsxs)(l.A,{sx:{p:1,py:1.5},children:[(0,H.jsx)(Ae.A,{children:(0,H.jsx)(Me.A,{severity:"error",sx:{lineHeight:0,display:"flex",justifyContent:"flex-start",mt:1},children:(0,H.jsx)(n.A,{variant:"caption",fontSize:14,children:"Dataset Already Exists. Please select the option given below."})})}),(0,H.jsx)(be.A,{children:(0,H.jsxs)(d.Ay,{container:!0,children:[(0,H.jsx)(d.Ay,{item:!0,xs:12,margin:1,children:(0,H.jsx)(_e.A,{initialValues:{},subscribe:x,onSubmit:e=>{},fields:f,size:{xs:12}})}),"new"===h().get(g,"importType")&&(0,H.jsxs)(d.Ay,{container:!0,spacing:3,justifyContent:"center",alignItems:"baseline",display:"flex",children:[(0,H.jsx)(d.Ay,{item:!0,xs:12,sm:6,lg:6,children:(0,H.jsx)(A.A,{title:"Name of the dataset",arrow:!0,placement:"top-start",children:(0,H.jsx)(c.A,{name:"name",label:"Dataset Name",onBlur:r.handleBlur,onChange:e=>o(e,r.setFieldValue,"dataset_id","name"),required:!0,value:h().get(r.values,"name")||"",variant:"outlined",fullWidth:!0,error:Boolean(r.errors.name),helperText:r.touched.name&&r.errors.name&&String(r.errors.name)})})}),(0,H.jsx)(d.Ay,{item:!0,xs:12,sm:6,lg:6,children:(0,H.jsx)(A.A,{title:"ID for the dataset - for querying",arrow:!0,placement:"top-start",children:(0,H.jsx)(c.A,{name:"dataset_id",label:"Dataset ID",onBlur:r.handleBlur,onChange:e=>r.handleChange(e),required:!0,value:h().get(r.values,"dataset_id")||"",variant:"outlined",fullWidth:!0,error:Boolean(r.errors.dataset_id),helperText:r.touched.dataset_id&&r.errors.dataset_id&&String(r.errors.dataset_id)})})})]}),(0,H.jsx)(d.Ay,{item:!0,xs:12,margin:1,children:(0,H.jsxs)(d.Ay,{container:!0,children:[(0,H.jsx)(d.Ay,{item:!0,marginRight:2,children:(0,H.jsx)(u.A,{variant:"contained",onClick:async()=>{const{importType:e}=g,{initialValues:t,values:i}=r,n="new"===e?i:t;await m({...n,importType:e}),a(!1)},disabled:!(!h().isEmpty(g)&&"new"!==h().get(g,"importType"))&&Boolean(r.errors.dataset_id||r.errors.dataset_id),children:"Import"})}),(0,H.jsx)(d.Ay,{item:!0,children:(0,H.jsx)(u.A,{variant:"contained",color:"error",onClick:()=>{const{initialValues:e}=r;r.setFieldValue("name",h().get(e,"")),r.setFieldValue("dataset_id",h().get(e,"")),s(!0),a(!1),t([])},children:"Cancel"})})]})})]})})]})},Oa="datasetConfiguration",Pa=e=>{let{setShowWizard:t,datasetType:a,generateInteractTelemetry:s}=e;const r=(0,x.wA)(),o=(0,x.d4)((e=>null===e||void 0===e?void 0:e.wizard)),h=(0,x.d4)((e=>{var t;return(null===e||void 0===e||null===(t=e.config)||void 0===t?void 0:t.maxFileSize)||5242880})),w=p.get(o,["pages",Oa]),{data:E,files:q,config:R}=(null===w||void 0===w?void 0:w.state)||{},[O,P]=(0,i.useState)(E),[$,N]=(0,i.useState)(q),[B,L]=(0,i.useState)(!1),[V,W]=(0,i.useState)(!1),[Z,U]=(0,i.useState)(!1),K="v2"===p.get(O,[0,"api_version"])?p.get(O,[0,"dataset_id"]):p.get(O,"[0].data.metadata.dataset_id"),G="v2"===p.get(O,[0,"api_version"])?p.get(O,[0,"name"]):p.get(O,"[0].data.metadata.dataset_id"),X=p.get(w,["state","config"])||{name:G||"",dataset_id:K||""},[J,Q]=(0,i.useState)(null),[ee,te]=(0,i.useState)({}),[ae,ie]=(0,i.useState)(!0),[ne,se]=(0,i.useState)([]),[re,oe]=(0,i.useState)(!1),le=(0,x.d4)((e=>{var t;return(null===e||void 0===e||null===(t=e.config)||void 0===t?void 0:t.validationLimit)||{}})),de=(0,i.useRef)(),ce=(0,z.Zp)();(0,i.useEffect)((()=>{(async()=>{try{const e=await(0,b.CO)({data:{}}),t=p.get(e,["data","result","data"]);if(p.size(t)){const e=p.map(t,(e=>p.get(e,"dataset_id")));se(e)}}catch(e){se([])}})()}),[]),(0,i.useEffect)((()=>{O&&(me.setFieldValue("name",G),me.setFieldValue("dataset_id",K))}),[V]);const ue=async e=>{if(U(!0),(O||$)&&e){U(!0);try{const t="overwrite"===p.get(e,"importType");if(await(async()=>(0,b.Rx)({datasetId:`${K}?status=${I.Zs.Live}`}).then((e=>{var t;return null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.result})).catch((e=>{console.log(e)})))()&&!re)return L(!0),W(!0),void oe(!0);await(0,b.yo)(O[0],e,t),ce(`/datasets?status=${I.Zs.Draft}`),r((0,y.kX)({message:"Dataset imported successfully"}))}catch(t){const e=p.get(t,["response","status"]),a=p.get(t,["response","data","error","code"]);409===e&&"DATASET_EXISTS"==a?(L(!0),W(!0)):r((0,y.z3)({message:"Failed to import dataset"}))}finally{U(!1)}}else r((0,y.z3)({message:"Please fill the required fields"}));U(!1)},me=(0,S.Wx)({initialValues:R||X,validationSchema:(e=>V&&m.Ik().shape({name:m.Yj().required("Dataset Name is required").min(p.get(e,"datasetMinLen")).max(p.get(e,"datasetMaxLen")).trim(T.whiteSpaceConflict).strict(!0).test("specialChars",T.hasSpecialCharacters,(e=>!(0,k.e3)(e))),dataset_id:m.Yj().required("Dataset ID is Required").min(p.get(e,"datasetIdMinLen")).max(p.get(e,"datasetIdMaxLen")).trim(T.whiteSpaceConflict).strict(!0).test("checkDuplID","ID is already taken",(async e=>new Promise((t=>{p.includes(ne,e)&&t(!1),t(!0)})))).test("specialChars",T.hasSpecialCharacters,(e=>!(0,k.e3)(e)))}))(le),onSubmit:ue,enableReinitialize:!0}),pe=(0,i.useRef)(me);de&&(de.current=pe.current);const he=(e,t,a,i)=>{t(i,e.target.value),t(a,j(e.target.value))};(0,i.useEffect)((()=>{ee!==me.values&&te(me.values)}),[me.values]);const ge=async()=>{const e=await(async()=>(0,k.lt)(de,ee))();ie(!e)};(0,i.useEffect)((()=>{p.isEmpty(O)||ge()}),[ee,O]);return(0,H.jsxs)(H.Fragment,{children:[Z&&(0,H.jsx)(M.A,{}),(0,H.jsx)(F.A,{open:Z}),(0,H.jsx)(d.Ay,{container:!0,spacing:1,children:(0,H.jsxs)(d.Ay,{item:!0,xs:12,sm:12,children:[(0,H.jsxs)("form",{onSubmit:me.handleSubmit,children:[(0,H.jsxs)(D.s,{elevation:1,children:[(0,H.jsx)(D.Z,{children:"Basic Details"}),(0,H.jsxs)(d.Ay,{container:!0,spacing:3,justifyContent:"center",alignItems:"baseline",display:"flex",children:[(0,H.jsx)(d.Ay,{item:!0,xs:12,sm:6,lg:6,children:(0,H.jsx)(A.A,{title:"Name of the dataset",arrow:!0,placement:"top-start",children:(0,H.jsx)(c.A,{name:"name",label:"Dataset Name",onBlur:me.handleBlur,onChange:e=>he(e,me.setFieldValue,"dataset_id","name"),required:!0,value:p.get(me.values,"name")||"",variant:"outlined",fullWidth:!0,error:!!V&&Boolean(me.errors.name),helperText:me.touched.name&&me.errors.name&&V&&String(me.errors.name)})})}),(0,H.jsx)(d.Ay,{item:!0,xs:12,sm:6,lg:6,children:(0,H.jsx)(A.A,{title:"ID for the dataset - for querying",arrow:!0,placement:"top-start",children:(0,H.jsx)(c.A,{name:"dataset_id",label:"Dataset ID",onBlur:me.handleBlur,onChange:e=>me.handleChange(e),required:!0,value:p.get(me.values,"dataset_id")||"",variant:"outlined",fullWidth:!0,error:!!V&&Boolean(me.errors.dataset_id),helperText:me.touched.dataset_id&&me.errors.dataset_id&&V&&String(me.errors.dataset_id)})})})]})]}),(0,H.jsxs)(D.s,{elevation:1,children:[(0,H.jsx)(D.Z,{children:"Import Dataset"}),(0,H.jsx)(d.Ay,{container:!0,spacing:3,justifyContent:"center",alignItems:"center",children:(0,H.jsx)(d.Ay,{item:!0,xs:12,children:(0,H.jsx)(v.A,{generateInteractTelemetry:s,data:O,setData:P,files:$,setFiles:N,maxFileSize:h,datasetImport:!0,allowSchema:!0,subscribeErrors:Q,isMultiple:!1,setNewFile:W})})})]}),$&&p.size($)>0&&(0,H.jsxs)(D.s,{elevation:1,children:[(0,H.jsxs)(l.A,{display:"flex",justifyContent:"space-between",children:[(0,H.jsx)(n.A,{variant:"h5",gutterBottom:!0,children:"Files Uploaded"}),(0,H.jsx)(u.A,{onClick:()=>{s({edata:{id:C.file_remove_multiple}}),N(null),P([]),r((0,f.cL)({omit:["datasetConfiguration"]}))},children:"Remove all"})]}),(0,H.jsx)(Y.A,{files:$,showList:!1,onRemove:async e=>{const t=$&&$.filter((t=>t!==e)),a=await Promise.all(t.map((e=>(0,k.lb)(e)))),i=(n=a,p.filter(p.flattenDeep(n),(e=>!p.isEmpty(e))));var n;0===p.size(i)?(N(t),P(i),p.isEmpty(t)||r((0,y.z3)({message:"Invalid file contents"}))):(N(t),P(i))}})]}),(null===J||void 0===J?void 0:J.length)>0&&(0,H.jsx)(_.Ay,{fileRejections:J}),(0,H.jsx)(l.A,{display:"flex",justifyContent:"flex-end",children:(0,H.jsx)(g.A,{children:(0,H.jsx)(u.A,{onClick:e=>s({edata:{id:C.create_dataset}}),disabled:Z||me.isSubmitting||p.isEmpty(O)||V&&ae,variant:"contained",sx:{my:2,ml:1},type:"submit",children:"Proceed"})})})]}),(0,H.jsx)(je.A,{maxWidth:"sm",fullWidth:!0,open:B,onClose:e=>L(!1),children:i.cloneElement((0,H.jsx)(Ra,{}),{setFiles:N,setOpenDailog:L,setCheckValidation:W,form:me,handleNameChange:he,onSubmit:ue,subscribeToFormChanges:ge,isLiveExists:re})})]})})]})};var $a=a(57904),Na=a(24056),Ba=a(37538);const La=e=>{const{diff:t=[],transform:a}=e,i=e=>h().map(e,((e,t)=>{const a=(0,ha.I)(e.key,!0);return a?(0,H.jsx)($.A,{variant:"outlined",label:`${a}: ${e.value}`},"review-config"+t):null})),n=[{Header:"Type",accessor:"type",Cell(e){var t,a;const i=(null===e||void 0===e||null===(t=e.cell)||void 0===t||null===(a=t.row)||void 0===a?void 0:a.original)||{};return(0,k.uI)(i)}},{Header:"Name",accessor:"name",Cell(e){var t,a;const i=(null===e||void 0===e||null===(t=e.cell)||void 0===t||null===(a=t.row)||void 0===a?void 0:a.original)||{};return(0,ha.I)(h().get(i,"name")||"")}},{Header:"Config",Cell(e){var t,a;const n=(null===e||void 0===e||null===(t=e.cell)||void 0===t||null===(a=t.row)||void 0===a?void 0:a.original)||{},s=(null===n||void 0===n?void 0:n.value)||{},r=(0,k.YO)(s);return(0,H.jsx)(P.A,{direction:"row",spacing:1,children:i(r)})}}],s=a(t);return(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(lt.A,{children:(0,H.jsx)(We.A,{content:!1,children:(0,H.jsx)(ot.A,{header:!0,columns:n,data:s,striped:!0})})})})},Va=e=>{const{diff:t=[],transform:a}=e,i=[{Header:"Type",accessor:"type",Cell(e){var t,a;const i=(null===e||void 0===e||null===(t=e.cell)||void 0===t||null===(a=t.row)||void 0===a?void 0:a.original)||{},n=(0,k.uI)(i);return(0,H.jsx)(d.Ay,{m:1,children:n})}},{Header:"Field",accessor:"field",Cell(e){var t,a;const i=(null===e||void 0===e||null===(t=e.cell)||void 0===t||null===(a=t.row)||void 0===a?void 0:a.original)||{},n=h().get(i,"field");return(0,ha.I)(n)}},{Header:"Property",accessor:"name",Cell(e){let{value:t}=e;return(0,ha.I)(t)||"-"}},{Header:"Current Live Value",accessor:"from",Cell(e){var t,a;const i=(null===e||void 0===e||null===(t=e.cell)||void 0===t||null===(a=t.row)||void 0===a?void 0:a.original)||{},n=h().get(i,"value.from");return n||!1===n?h().toString(n):"-"}},{Header:"Updated Value",accessor:"to",Cell(e){var t,a;const i=(null===e||void 0===e||null===(t=e.cell)||void 0===t||null===(a=t.row)||void 0===a?void 0:a.original)||{},n=h().get(i,"value.to");return n||!1===n?h().toString(n):"-"}}],n=h().filter(a(t),(e=>!h().includes(["batch_id"],h().get(e,"field"))));return(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(lt.A,{children:(0,H.jsx)(We.A,{content:!1,children:(0,H.jsx)(ot.A,{header:!0,columns:i,data:n,striped:!0})})})})},Wa=e=>{const{diff:t=[],transform:a}=e,i=[{Header:"Type",accessor:"type",Cell(e){var t,a;const i=(null===e||void 0===e||null===(t=e.cell)||void 0===t||null===(a=t.row)||void 0===a?void 0:a.original)||{},n=(0,k.uI)(i);return(0,H.jsx)(d.Ay,{m:1,children:n})}},{Header:"Name",accessor:"name",Cell(e){var t,a;const i=(null===e||void 0===e||null===(t=e.cell)||void 0===t||null===(a=t.row)||void 0===a?void 0:a.original)||{};return(0,ha.I)(h().get(i,"name")||"")}}],n=a(t);return(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(lt.A,{children:(0,H.jsx)(We.A,{content:!1,children:(0,H.jsx)(ot.A,{header:!0,columns:i,data:n,striped:!0})})})})};var Za=a(26480),Ua=a(28780),Ka=a(30492);const Ga=e=>{let{handleBack:t,master:a,edit:i,datasetState:s,liveDataset:r=!1,diff:o={}}=e;const{additions:l=[],deletions:c=[],modifications:u=[]}=o,m=0===h().size(h().flatten([l,c,u])),p=e=>h().flatten(h().map(e,(e=>{const{type:t,items:a=[],value:i}=e;return[...h().map(a,(e=>({type:t,...e}))),...i?[{type:t,value:i}]:[]]}))),g=[...null!==l&&void 0!==l&&l.length?[{id:"additions",title:(0,H.jsxs)(P.A,{direction:"row",spacing:2,children:[(0,H.jsx)(Za.A,{color:"info"}),"  ",(0,H.jsx)(n.A,{variant:"inherit",children:"Additions"})]}),description:"Lists down all the additions in the configurations",component:(0,H.jsx)(La,{diff:l,transform:p})}]:[],...null!==u&&void 0!==u&&u.length?[{id:"updates",title:(0,H.jsxs)(P.A,{direction:"row",spacing:2,children:[(0,H.jsx)(Ka.A,{color:"warning"}),"  ",(0,H.jsx)(n.A,{variant:"inherit",children:"Modification"})]}),description:"Lists down all the modifications in the configuration along with new and old value",component:(0,H.jsx)(Va,{diff:u,transform:p})}]:[],...null!==c&&void 0!==c&&c.length?[{id:"deletion",title:(0,H.jsxs)(P.A,{direction:"row",spacing:2,children:[(0,H.jsx)(Ua.A,{color:"error"}),"  ",(0,H.jsx)(n.A,{variant:"inherit",children:"Deletion"})]}),description:"Lists down all the deletions in the configurations",component:(0,H.jsx)(Wa,{diff:c,transform:p})}]:[]];null!==g&&void 0!==g&&g.length&&h().set(g,"[0].componentType","box");return(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(d.Ay,{container:!0,children:m?(0,H.jsx)(d.Ay,{item:!0,xs:12,children:(0,H.jsx)(Me.A,{severity:"info",children:T["no-summary-modifications"]})}):(0,H.jsxs)(d.Ay,{item:!0,xs:12,children:[(0,Ba.H1)({sections:g}),(0,H.jsx)(Me.A,{severity:"error",children:T["dataset-summary-review-warning"]})]})})})};var Xa=a(85041);const Ja=e=>{let{reviewDiff:t}=e;return{title:(0,H.jsx)(Rt.A,{id:"save-dataset-title"}),content:(0,H.jsxs)(d.Ay,{container:!0,children:[(0,H.jsxs)(d.Ay,{item:!0,xs:12,children:[(0,H.jsx)(Rt.A,{id:"save-dataset-context"})," "]}),(0,H.jsxs)(d.Ay,{item:!0,xs:12,children:[" ",!h().isEmpty(t)&&(0,H.jsx)(Rt.A,{id:"review-dataset-context"})]})]})}},Qa=e=>{let{handleBack:t,master:a,datasetState:s,liveDataset:r=!1}=e;const[o,c]=(0,i.useState)(!1),[u,m]=(0,i.useState)({}),[f,v]=(0,i.useState)(0),S=(0,O.A)(),[j,A]=(0,i.useState)(!1),w=(0,x.wA)(),Y=(0,z.Zp)(),D=(0,x.d4)((e=>e)),C=(0,x.d4)((e=>null===e||void 0===e?void 0:e.wizard)),_=(0,x.d4)((e=>h().get(e,"dataset.data")||[])),k=(0,Fa.E)(_),[T,E]=(0,i.useState)(!1),q=h().get(C,"pages.datasetConfiguration.state.config.dataset_id"),R=h().get(C,"pages.datasetConfiguration.state.config.name"),$=[{index:0,label:"All Configurations",component:(0,H.jsx)(Xa.A,{master:a}),disabled:()=>!1},{index:1,label:"Summary",component:(0,H.jsx)(Ga,{diff:u}),disabled:()=>(0,p.isEmpty)(u)}],N=(e,t)=>{v(t)};(0,i.useEffect)((()=>{(async()=>{try{c(!0);const e=await(0,b.Ew)(q);m(e)}catch(e){}finally{c(!1)}})(),(async()=>{(0,b.Rx)({datasetId:`${q}?status=${I.Zs.Live}`}).then((e=>{var t,a;const i=null===e||void 0===e||null===(t=e.data)||void 0===t||null===(a=t.result)||void 0===a?void 0:a.name;E(i!==R)})).catch((e=>{console.log(e)}))})()}),[R]);const B=()=>{t()},L=e=>{if(T)return!1;const{additions:t=[],deletions:a=[],modifications:i=[]}=e;return 0===h().size(h().flatten([t,a,i]))};return(0,H.jsx)(H.Fragment,{children:(0,H.jsxs)(d.Ay,{container:!0,spacing:2,children:[o&&(0,H.jsx)(M.A,{}),(0,H.jsx)(F.A,{open:o}),(0,H.jsx)(d.Ay,{item:!0,xs:12,id:"tabSectionStart",children:(0,H.jsx)(l.A,{sx:{width:"100%"},children:(0,H.jsx)($a.A,{variant:"standard",value:f,onChange:N,TabIndicatorProps:{hidden:!0},sx:{background:"#FFFFFF"},children:h().map($,(e=>{const{label:t,index:a,disabled:i}=e;return i()?null:(0,H.jsx)(Na.A,{label:t,sx:{border:"unset","&.Mui-selected":{backgroundColor:S.palette.primary.main,color:"white"}}},a)}))})})}),(0,H.jsx)(d.Ay,{xs:12,marginTop:1,children:h().get($,[f,"component"])}),r?null:(0,H.jsx)(d.Ay,{item:!0,xs:12,children:(0,H.jsxs)(P.A,{direction:"row",justifyContent:"space-between",children:[(0,H.jsx)(g.A,{children:(0,H.jsx)(mt.m,{variant:"outlined",type:"button",onClick:B,children:(0,H.jsx)(n.A,{variant:"h5",children:"Previous"})})}),(0,H.jsx)(g.A,{children:(0,H.jsx)(mt.m,{variant:"contained",type:"button",disabled:!h().isEmpty(u)&&L(u),onClick:()=>{(0,b.y7)({}),A(!0)},children:(0,H.jsx)(n.A,{variant:"h5",children:"Save Dataset"})})})]})}),(0,H.jsx)(V.A,{open:j,handleClose:()=>A(!1),context:Ja({reviewDiff:u}),action:async()=>{try{c(!0),await(0,b.C_)(C,D,a,k),w((0,Ea.U)({data:{filters:{status:[I.Zs.Live,I.Zs.Retired]}}})),w((0,y.kX)({message:"Dataset Saved."})),Y(`/datasets?status=${I.Zs.ReadyToPublish}`)}catch(e){w((0,y.z3)({message:"Save Dataset Failed. Please try again later."}))}finally{c(!1)}}})]})})},ei=["Schema","Input","Fields","Processing","Review"],ti=["Schema","Input","Fields","Review"],ai=(e,t,a,i,n,s,r)=>{if(n)switch(e){case 0:return(0,H.jsx)(Le,{handleBack:a,handleNext:t,setErrorIndex:i,index:0,edit:s,master:n,generateInteractTelemetry:r});case 1:return(0,H.jsx)(Ha,{handleBack:a,handleNext:t,setErrorIndex:i,index:1,section:"input",edit:s,master:n,generateInteractTelemetry:r});case 2:return(0,H.jsx)(Ha,{handleBack:a,handleNext:t,setErrorIndex:i,index:2,section:"field",edit:s,generateInteractTelemetry:r});case 3:return(0,H.jsx)(Qa,{handleBack:a,handleNext:t,setErrorIndex:i,index:3,master:n,edit:s,generateInteractTelemetry:r});default:throw new Error("Unknown step")}else switch(e){case 0:return(0,H.jsx)(Le,{handleBack:a,handleNext:t,setErrorIndex:i,index:0,edit:s,generateInteractTelemetry:r});case 1:return(0,H.jsx)(Ha,{handleBack:a,handleNext:t,setErrorIndex:i,index:1,section:"input",edit:s,generateInteractTelemetry:r});case 2:return(0,H.jsx)(Ha,{handleBack:a,handleNext:t,setErrorIndex:i,index:2,section:"field",edit:s,generateInteractTelemetry:r});case 3:return(0,H.jsx)(Ha,{handleBack:a,handleNext:t,setErrorIndex:i,index:3,section:"processing",edit:s,generateInteractTelemetry:r});case 4:return(0,H.jsx)(Qa,{handleBack:a,handleNext:t,setErrorIndex:i,index:5,edit:s,generateInteractTelemetry:r});default:throw new Error("Unknown step")}},ii=e=>{let{edit:t=!1,master:a=!1,key:d=Math.random(),isImport:c=!1,page:u}=e;const[m,h]=(0,i.useState)(!1),[g,v]=(0,i.useState)(null),{state:y}=(0,z.zy)(),S=(0,z.Zp)(),{datasetId:j}=(0,z.g)(),A=(0,x.d4)((e=>null===e||void 0===e?void 0:e.wizard)),b=p.get(A,"pages.datasetConfiguration.state.config.dataset_id"),w=+u||p.get(A,["metadata",`${b}_activePage`])||0,[Y,D]=(0,i.useState)(w);(0,ve.A)({type:"view",pageid:p.get(ye.A,[a?"masterdataset":"dataset",t?"edit":"create"])});const C=(0,x.wA)(),_=p.get(ye.A,[a?"masterdataset":"dataset",t?"edit":"create"]),k=a?"masterDataset":"dataset",M=e=>{let{edata:{id:t}}=e;const a=p.get(A,"pages.datasetConfiguration.state.config.dataset_id");(0,qa.Se)({object:a?{id:a,type:k,version:"1.0.0"}:{},edata:{id:`${_}:${t}`,type:"CLICK"}})},F=async e=>{C((0,f.WK)({id:`${b}_activePage`,value:e}))};(0,i.useEffect)((()=>(C((0,Ea.U)({data:{filters:{status:[I.Zs.Live,I.Zs.Retired]}}})),t&&h(!0),()=>{C((0,f.cL)({}))})),[]),(0,i.useEffect)((()=>{w&&w!==Y&&D(w)}),[w]),(0,i.useEffect)((()=>{(y&&y.refreshMaster||a)&&!t&&(D(0),S({pathname:"/dataset/new/master",search:(0,za.PI)({master:"true"}).toString()}),a=!0)}),[y]);const T=(e,t)=>{const a={};return t===g&&(a.optional=(0,H.jsx)(n.A,{variant:"caption",color:"error",children:"Error"}),a.error=!0),(0,H.jsx)(s.A,{children:(0,H.jsx)(r.A,{...a,children:e})},Math.random())};return(0,i.useEffect)((()=>{window.location.href="/home/new-dataset"}),[]),(0,H.jsx)(H.Fragment,{children:(0,H.jsx)(l.A,{children:(0,H.jsxs)(H.Fragment,{children:[m&&(0,H.jsxs)(o.A,{activeStep:Y,sx:{py:2},children:[a&&ti.map(T),!a&&ei.map(T)]}),!m&&!c&&(0,H.jsx)(q,{setShowWizard:h,datasetType:a?I.DE.MasterDataset:I.DE.Dataset,generateInteractTelemetry:M},d),c&&!m&&(0,H.jsx)(Pa,{setShowWizard:h,datasetType:a?I.DE.MasterDataset:I.DE.Dataset,generateInteractTelemetry:M},d),m&&ai(Y,(()=>{D((e=>{const t=e+1;return F(t),sessionStorage.setItem(`${b}_activePage`||"",t),t})),v(null)}),(()=>{0===Y?h(!1):D((e=>{const t=e-1;return F(t),sessionStorage.setItem(`${b}_activePage`||"",t),t}))}),v,a,t,M)]})})})}},47830:(e,t,a)=>{a.d(t,{C:()=>o,h:()=>l});var i=a(18666),n=a(92073),s=a(78293),r=a(79074);const o=e=>{let{data:t,config:a={}}=e;const{datasetId:n}=t,o=(0,r.Fj)({apiId:"api.datasets.status-transition",request:{dataset_id:n,status:"Live"}});return i.LV.post(s.A.statusTransition,o,a)},l=(e,t)=>{const a={id:(0,n.A)(),dataset_id:t,data:[{...e}]};return i.LV.post(s.A.detectPiiFields,a)}}}]);
//# sourceMappingURL=213.a0224cef.chunk.js.map