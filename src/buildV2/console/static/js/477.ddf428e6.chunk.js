"use strict";(self.webpackChunksunbird_obsrv=self.webpackChunksunbird_obsrv||[]).push([[477],{23477:(e,t,a)=>{a.r(t),a.d(t,{default:()=>O});var s=a(38089),r=a(53536),n=a.n(r),i=a(73216),o=a(35475),l=a(97508),c=a(8387),d=a(34150),u=a(65043),g=a(85865),p=a(40036),h=a(79226),m=a(67407),x=a(61966),f=a(89379);const y={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"};var A=a(8436),j=function(e,t){return u.createElement(A.A,(0,f.A)((0,f.A)({},e),{},{ref:t,icon:y}))};const v=u.forwardRef(j);var b=a(75337),w=a(68903),Z=a(67254),D=a(74600),S=a(42518),k=a(8248),C=a(23592),z=a(26240),L=a(17392),I=a(41066),R=a(62291),T=a(1195),_=a(98612),E=a(91462),F=a(50644),H=a(59507),P=a(85260),$=a(70579);const W=()=>{const e=(0,l.wA)(),t=(0,i.Zp)(),a=(0,i.g)(),s=(0,z.A)(),{datasetId:r}=a,[o,g]=(0,u.useState)([]),[p,f]=(0,u.useState)(!1),[y,A]=(0,u.useState)(!1),[j,W]=(0,u.useState)(""),B=async()=>{try{A(!0);const e=await(0,d.Bh)({data:{filters:{status:[H.Zs.Draft,H.Zs.ReadyToPublish,H.Zs.Live],dataset_id:`${r}`}}});g(e)}catch(t){e((0,c.z3)({message:P.faildToFetch}))}finally{A(!1)}};(0,u.useEffect)((()=>{B()}),[]);const G=n().map(o,(e=>{if(!0===n().get(e,"ingestion_spec.spec.dataSchema.granularitySpec.rollup")){var t;return null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.granularity}})),O=e=>{var t;return null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.granularity},X=n().filter(o,(e=>{if(!0===n().get(e,"ingestion_spec.spec.dataSchema.granularitySpec.rollup"))return e})),q=n().map(X,(e=>({name:null===e||void 0===e?void 0:e.dataset_id,datasourceId:null===e||void 0===e?void 0:e.datasource,id:null===e||void 0===e?void 0:e.id,aggregation:O(e),aggregationLable:n().capitalize(O(e).replaceAll("_"," "))}))),M=[{Header:"Datasource name",accessor:"name"},{Header:"Aggregation level",accessor:"aggregationLable"},{Header:"Actions",accessor:"actions",Cell:e=>{const a=e.row.original.id;e.row.original.datasourceId;return(0,$.jsxs)(R.A,{sx:{marginLeft:-1.5},children:[(0,$.jsx)(L.A,{color:"primary",size:"large",onClick:()=>{t(`/datasets/configurerollups/${r}`,{state:{rollupGranularityOption:G,edit:!0,rollupDatasourceName:e.row.original.datasourceId,aggregationLevel:e.row.original.aggregation}})},children:(0,$.jsx)(m.A,{style:{color:s.palette.primary.main}})}),(0,$.jsx)(L.A,{color:"primary",size:"large",onClick:()=>{f(!0),W(a)},children:(0,$.jsx)(x.A,{style:{color:s.palette.error.main}})})]})}}];return(0,$.jsxs)($.Fragment,{children:[y&&(0,$.jsx)(_.A,{}),(0,$.jsx)(E.A,{open:y}),(0,$.jsxs)(w.Ay,{container:!0,children:[n().isEmpty(q)?(0,$.jsx)($.Fragment,{children:(0,$.jsx)(Z.A,{sx:{display:"flex",alignItems:"center"},severity:"error",children:P.clickToCreateRollup})}):n().get(X,"length")?(0,$.jsx)(w.Ay,{item:!0,xs:12,children:(0,$.jsx)(h.A,{content:!1,headerSX:{},children:(0,$.jsx)(k.A,{children:(0,$.jsx)(C.A,{header:!0,columns:M,data:q,striped:!0})})})}):null,(0,$.jsxs)(w.Ay,{item:!0,xs:12,children:[X.length===F.p3.length?(0,$.jsx)($.Fragment,{}):(0,$.jsxs)(D.A,{direction:"row",justifyContent:"space-between",alignItems:"center",mt:1,children:[(0,$.jsx)(S.A,{size:"medium",startIcon:(0,$.jsx)(v,{}),sx:{fontWeight:500},onClick:()=>t(`/datasets?status=${H.Zs.ReadyToPublish}`),children:"Previous"}),(0,$.jsx)(S.A,{size:"medium",startIcon:(0,$.jsx)(b.A,{}),sx:{fontWeight:500},onClick:()=>{t(`/datasets/configurerollups/${r}`,{state:{rollupGranularityOption:G,edit:!1}})},children:"Add Rollup"})]}),(0,$.jsx)(T.A,{open:p,handleClose:()=>{f(!1)},action:async()=>{try{await(0,I.n2)(j,H.Zs.Draft),e((0,c.kX)({message:P.datasourceDeleted})),B(),f(!1)}catch(t){e((0,c.z3)({message:P.faildToDeleteDatasource}))}},context:{title:"Delete rollup datasource",content:"Are you sure you want to delete this rollup datasource ?"}})]})]})]})};var B=a(43482),G=a(85041);const O=()=>{const{datasetId:e}=(0,i.g)(),[t]=(0,o.ok)(),a=(0,l.wA)(),r=t.get("master")||"false",m=t.get("status")||H.Zs.Draft,[x,f]=(0,u.useState)({}),[y,A]=(0,u.useState)(!0),j=n().get(x,["pages","datasetConfiguration","state","config","name"])||e,v=(0,l.d4)((e=>n().get(e,"dataset.data.data")||[]));(0,u.useEffect)((()=>{n().isEmpty(v)&&a((0,B.U)({data:{filters:{status:[H.Zs.Live,H.Zs.Retired]}}}))}),[]);(0,u.useEffect)((()=>{(async()=>{A(!0);try{const t=await(0,d.sq)(e,m);f(t)}catch(t){a((0,c.z3)({message:"Dataset does not exists"}))}finally{A(!1)}})()}),[]);const b=[{title:(0,$.jsxs)(g.A,{variant:"body1",fontWeight:500,children:["Review - ",n().capitalize(j)]}),id:j,componentType:"box",component:(0,$.jsx)(G.A,{datasetState:x,master:"true"==r})}],w=[{id:"rollups",title:"Rollup Datasources",component:(0,$.jsx)(W,{}),componentType:"box"}];return(0,$.jsx)($.Fragment,{children:y?(0,$.jsxs)(h.A,{content:!1,children:[(0,$.jsx)(p.A,{type:"table"}),(0,$.jsx)(_.A,{})]}):(0,$.jsx)(s.A,{sections:(()=>{const e={[H.Zs.Live]:b,[H.Zs.Draft]:w,[H.Zs.Publish]:w,[H.Zs.ReadyToPublish]:w};return n().get(e,m)||[]})()})})}}}]);
//# sourceMappingURL=477.ddf428e6.chunk.js.map